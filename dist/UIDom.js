!function(){'use strict';var e,t,o;(e=>{e[e.Data=1]='Data',e[e.Actions=2]='Actions',e[e.Otherwise=4]='Otherwise',e[e.DoRefresh=8]='DoRefresh',e[e.NoRefresh=16]='NoRefresh',e[e.Contextual=3]='Contextual',e[e.All=7]='All'})(e||(e={})),(e=>{e[e.Cascading=1]='Cascading',e[e.Parent=2]='Parent',e[e.Overridden=4]='Overridden',e[e.All=7]='All'})(t||(t={})),(e=>{e[e.always=-2]='always',e[e.deep=-1]='deep',e[e.changed=0]='changed',e[e.shallow=1]='shallow',e[e.double=2]='double'})(o||(o={}));const n={range(e,t,o=1){'number'!=typeof t&&([t,e]=[e,0]);const n=[];if(t<e)for(let s=e-1;s>=t;s-=o)n.push(s);else for(let s=e;s<t;s+=o)n.push(s);return n},buildRecordable(e){if(e.constructor===Object)return e;const t={};for(const o of e)t[o]=!0;return t},cleanHtmlProps(e,t){const o=t?Object.assign({},e):e;return o.className&&(o.class=o.class?o.class+' '+o.className:o.className),delete o.className,'string'==typeof o.style&&(o.style=n.cleanHtmlStyle(o.style)),o},cleanHtmlStyle(e){const t=e.replace(/\/\*(.|\s)*?\*\//g,' ').replace(/\s+/g,' ').trim();if(!t)return{};const o={},n=t.split(';').map((e=>e.split(':').map((e=>e&&e.trim()))));for(const[e,t]of n)e&&(o[e.replace(/\W+\w/g,(e=>e.slice(-1).toUpperCase()))]=t);return o},cleanHtmlClass(...e){const t={};for(const o of e)o&&n.collectNamesTo(o,t,' ');return Object.keys(t).join(' ')},collectNamesTo(e,t,o=''){switch(typeof e){case'string':if(o)for(const n of e.split(o))n&&(t[n]=!0);else t[e]=!0;break;case'object':if(e.constructor===Object)for(const o in e)o&&e[o]&&(t[o]=!0);else for(const n of e)if(n&&'string'==typeof n)if(o)for(const e of n.split(o))e&&(t[e]=!0);else t[n]=!0}},getClassNameDiffs(e,t){if((e=e||'')===(t=t||''))return null;const o=e.split(' '),n=t.split(' '),s={};let r=null;if(o)for(const e of o)!e||n&&-1!==n.indexOf(e)||(s[e]=r=!1);if(n)for(const e of n)!e||o&&-1!==o.indexOf(e)||(s[e]=r=!0);return null!==r?s:null},getDictionaryDiffs(e,t,o){const n={};for(const o in e){void 0!==e[o]&&void 0===t[o]&&(n[o]=void 0)}for(const o in t){const s=t[o];e[o]!==s&&(n[o]=s)}if(o)for(const e of o)delete n[e];for(const e in n)return n;return null},equalDomProps(e,t){if(e.style){if(!t.style)return!1;const o=e.style,n=t.style;for(const e in n)if(o[e]!==n[e])return!1;for(const e in o)if(void 0===n[e]&&void 0!==o[e])return!1}else if(t.style)return!1;for(const o in t)if(e[o]!==t[o]&&'style'!==o)return!1;for(const o in e)if(void 0===t[o]&&void 0!==e[o]&&'style'!==o)return!1;return!0},areEqual(e,t,o=-1){if(e===t)return!0;if(e&&o&&'object'==typeof e){if(!t||'object'!=typeof t)return!1;const s=e.constructor;if(s!==t.constructor)return!1;o--;let r=!1;switch(s){case Object:break;case Array:r=!0;break;case Set:r=!0,e=[...e],t=[...t];break;case Map:if(e.size!==t.size)return!1;for(const[s,r]of e){if(!t.has(s))return!1;if(!n.areEqual(t.get(s),r,o))return!1}return!0;default:const s=e.toString();'[object NodeList]'!==s&&'[object HTMLCollection]'!==s||(r=!0)}if(r){const s=e.length;if(s!==t.length)return!1;for(let r=0;r<s;r++)if(!n.areEqual(e[r],t[r],o))return!1}else{for(const s in t){if(!e.hasOwnProperty(s))return!1;if(!n.areEqual(e[s],t[s],o))return!1}for(const o in e)if(!t.hasOwnProperty(o))return!1}return!0}return!1}};var s=(e,t)=>{var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&'function'==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(o[n[s]]=e[n[s]])}return o};const r={getDefType(e){if('string'==typeof e)return'dom';const t=e.UI_DOM_TYPE;if(!t)return'function'==typeof e?'boundary':'';switch(t){case'Live':case'Mini':case'Wired':return'boundary';case'Spread':case'Fragment':case'Portal':case'Element':case'Contexts':case'Host':return t.toLowerCase();default:return''}},createDef(e='div',t=null,...o){const i=r.getDefType(e);if(!i)return null;const d=[];let a=!1,c=0;for(const e of o){let t='string'==typeof e;if(e&&t&&a){d[c-1].domContent+=e;continue}const o=r.createDefFromContent(e);o&&(c=d.push(o),a=t)}if('spread'===i)return e.unfold(t||{},d);if('fragment'===i&&!d[0])return null;const l='dom'===i&&e||'boundary'===i&&e||'element'===i&&'_'||('content'===i?'':null),u={_uiDefType:i,tag:l,childDefs:d},f=!!l;if('fragment'===u._uiDefType)t&&void 0!==t.withContent&&(u.withContent=t.withContent);else if(t){const{key:e,ref:o,contexts:r}=t,d=s(t,['key','ref','contexts']);if(null!=e&&(u.key=e),o){const e=[];if('Ref'===o.constructor.UI_DOM_TYPE)e.push(o);else for(const t of o)t&&'Ref'===t.constructor.UI_DOM_TYPE&&-1===e.indexOf(t)&&e.push(t);u.attachedRefs=e}r&&'boundary'===i&&(u.attachedContexts=Object.assign({},r)),f&&(u.props='string'==typeof l?n.cleanHtmlProps(d):d)}else f&&(u.props={});switch(u._uiDefType){case'portal':{const e=t||{};u.domPortal=e.container||null,!d[0]&&e&&null!=e.content&&(o=[e.content]);break}case'contexts':u.contexts=(t||{}).cascade||null;break;case'element':{const e=t||{};u.domElement=e.element||null,u.domCloneMode=null!=e.cloneMode?'boolean'==typeof e.cloneMode?e.cloneMode?'deep':'':e.cloneMode:null,delete u.props.element,delete u.props.cloneMode;break}}return u},createDefFromContent(e){if(e&&'object'==typeof e){if('string'==typeof e._uiDefType)return e;if(e instanceof Node)return{_uiDefType:'content',tag:'',childDefs:[],domContent:e};if('Host'===e.constructor.UI_DOM_TYPE)return{_uiDefType:'host',tag:null,host:e,key:e,childDefs:[]};if(Array.isArray(e)||e instanceof HTMLCollection||e instanceof NodeList){const t=[...e].map((e=>r.createDefFromContent(e))).filter((e=>e));return t.length?{_uiDefType:'fragment',tag:null,isArray:!0,childDefs:t}:null}e=String(e)}return null!=e?{_uiDefType:'content',tag:'',domContent:e,childDefs:[]}:null},newAppliedDefBy(e,t){const o={_uiDefType:e._uiDefType,tag:e.tag,key:e.key,childDefs:[],action:'mounted'};return e.isArray?o.isArray=!0:'pass'===o._uiDefType?o.contentPass=t||null:e.host&&(o.host=e.host),void 0!==e.keyScope&&(o.keyScope=e.keyScope),o},newContentPassDef(e,t){const o={_uiDefType:'pass',tag:null,childDefs:[],contentPassType:t?'copy':'pass'};return null!=e?o.key=e:t||(o.key=r.ContentKey),o},newContentCopyDef:e=>r.newContentPassDef(e,!0),ContentKey:{}};class i{constructor(e){}}i.UI_DOM_TYPE='Fragment';class d{constructor(e){}}d.UI_DOM_TYPE='Portal';class a{constructor(e){}}a.UI_DOM_TYPE='Element';class c{constructor(e){}static unfold(e,t){return null}static unfoldWith(e,t,o){let n,s=[[e,null]],r=!1,i=0;for(;n=s[i];){i++;let d=n[0];const a=n[1];if('fragment'===d._uiDefType&&d.withContent){const o=Object.assign({},d);delete o.withContent,t.length||(o.childDefs=[]),a?a.childDefs[a.childDefs.indexOf(d)]=o:e=o,d=o}if(d.keyScope=o,'pass'===d._uiDefType){const o={_uiDefType:'fragment',tag:null,childDefs:[...t]};if(null!==d.key&&(o.key=d.key),a?a.childDefs[a.childDefs.indexOf(d)]=o:e=o,r||'copy'===d.contentPassType){const e=null!=d.key?d.key:null;let t,n=[o],s=0;for(;t=n[s];)if(s++,t.childDefs[0]){let o=0;for(const n of t.childDefs){const s='pass'===n._uiDefType?n:Object.assign(Object.assign({},n),{childDefs:[...n.childDefs],keyScope:e});t.childDefs[o]=s,o++}n=t.childDefs.concat(n.slice(s)),s=0}}else r=!0}else if(d.childDefs[0]){const e=[];for(const t of d.childDefs)e.push([t,d]);s=e.concat(s.slice(i)),i=0}}return e}}c.UI_DOM_TYPE='Spread';const l=e=>{var t;return(t=class e extends c{static unfold(t,o){let n=r.createDefFromContent(e.render(t));if(n){const t=null==n.key?e:n.key;n=e.unfoldWith(n,o,t)}return n}}).render=e,t};var u=(e,t)=>{var o={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(o[n]=e[n]);if(null!=e&&'function'==typeof Object.getOwnPropertySymbols){var s=0;for(n=Object.getOwnPropertySymbols(e);s<n.length;s++)t.indexOf(n[s])<0&&Object.prototype.propertyIsEnumerable.call(e,n[s])&&(o[n[s]]=e[n[s]])}return o};class f{constructor(e){this.settings=e,this.externalElements=new Set}getApprovedNode(e,t){let o=e;const n=null!=t.def.domCloneMode?t.def.domCloneMode:this.settings.duplicateDomNodeBehaviour;return('always'===n||this.externalElements.has(e))&&(o=this.settings.duplicateDomNodeHandler?this.settings.duplicateDomNodeHandler(e,t):n?e.cloneNode('deep'===n||'always'===n):null),o&&this.externalElements.add(o),o}createDomNodeBy(e){const t=e.def.tag;if('string'!=typeof t)return null;if('_'===t)return e.def.domElement&&this.getApprovedNode(e.def.domElement,e)||null;const o=e.def.domContent;if(o instanceof Node)return this.getApprovedNode(o,e);if(e.def.domHtmlMode&&null!=o&&''!==o)return f.domNodeFrom(o.toString(),t||this.settings.renderInnerHtmlTag,!0);if(t)return'svg'===t||e.parent&&e.parent.domNode&&void 0!==e.parent.domNode.ownerSVGElement?document.createElementNS(this.settings.renderSvgNamespaceUri||'http://www.w3.org/2000/svg',t):document.createElement(t);let n=null,s='',r='';if(null!=o){r=(this.settings.renderTextContent?this.settings.renderTextContent(o):o).toString();const e=this.settings.renderTextTag;if(e)if('string'==typeof e)s=e;else if('function'==typeof e){const t=e(o);t instanceof Node&&(n=t)}}return n||(n=s?document.createElement(s):document.createTextNode(r)),s&&r&&(n.textContent=r),n}applyToDom(e){const t=[];let o=null;const n=[];this.settings.devLogRenderInfos&&console.log('__UIRender.applyToDom: Dev-log: Received rendering infos: ',e);for(const s of e){const e=s.treeNode;if(s.remove){if('dom'===e.type&&e.domNode){const n=e.domNode,s=n.parentNode,r=e.def.attachedRefs;let i=!1;if(r)for(const t of r)t&&t.domWillUnmount&&t.domWillUnmount(n)&&(i=!0),U.willDetachFrom(t,e);i?o?o.push(n):o=[n]:!s||-1!==t.indexOf(s)||o&&o.some((e=>e.contains(n)))||s.removeChild(n);const d='element'===e.def._uiDefType;(d||'content'===e.def._uiDefType)&&this.externalElements.delete(n),d||t.push(n),e.domNode=null,f.updateDomChainBy(e,null)}continue}let r=!1,i=!1;if(s.refresh&&e.domNode&&e.domProps&&(e.domProps='read'===s.refresh?f.readFromDom(e.domNode):{},r=!0),s.create)switch(e.type){case'dom':const t=this.createDomNodeBy(e);t&&(e.domNode=t,i=!0);break;case'portal':e.domNode=e.def.domPortal||null}if(i||s.move)if('host'===e.type){const t=e.def.host||null;t&&t.refresh(!1,null,null),e.domNode=e.parent&&t&&t.getRootDomNode()||null,f.updateDomChainBy(e,e.domNode)}else{const t=e.domNode;if(t){const e=t.parentNode;n.push([s,e]),e&&e.removeChild(t)}f.updateDomChainBy(e,t)}if(s.swap){const t=e.domNode;let o=('portal'===e.type?e.def.domPortal:e.def.domElement)||null;if(t!==o){if('dom'===e.type){const n=e,s=t&&t.parentNode;if(o&&(o=this.getApprovedNode(o,n),o)){let[n,r]=s?[s,t]:f.findInsertionNodes(e);n&&n.insertBefore(o,r)}if(t){if(this.externalElements.delete(t),n.domProps&&t instanceof Element)for(const e in n.domProps){const o=f.LISTENER_PROPS[e];o&&t.removeEventListener(o,n.domProps[e])}s&&s.removeChild(t)}n.domProps&&(n.domProps=o&&'read'===this.settings.renderDomPropsOnSwap?f.readFromDom(o):{},r=!0)}for(const t of e.children){const e=t.domNode;e&&(e.parentNode&&e.parentNode.removeChild(e),o&&o.appendChild(e))}e.domNode=o,f.updateDomChainBy(e,o)}}if(s.content&&'dom'===e.type&&e.domNode){const t=e.def.domContent,o=e.domNode;let n=o;if('content'===e.def._uiDefType){if(e.def.domHtmlMode&&null!=t&&''!==t)n=f.domNodeFrom(t.toString(),e.def.tag||this.settings.renderInnerHtmlTag,!0),e.domProps&&(r=!0,e.domProps={});else{const e=null==t?'':(this.settings.renderTextContent?this.settings.renderTextContent(t):t).toString();3!==o.nodeType?n=document.createTextNode(e):o.textContent=e}}else if(t instanceof Node){const e=t.parentNode;e&&e.removeChild(t)}else o.textContent='';if(o!==n){const t=o.parentNode;t&&(e.domNode=n,t.insertBefore(n,o),t.removeChild(o)),f.updateDomChainBy(e,e.domNode)}const s=e.def.attachedRefs;if(s)for(const o of s)o&&o.domDidContent&&o.domDidContent(e.domNode,null!=t?t:null)}if((i||r||s.update)&&'dom'===e.type&&e.domNode&&e.domNode instanceof Element){const t=f.domApplyProps(e,this.settings.devLogWarnings),{appliedProps:o}=t,n=u(t,['appliedProps']);if(e.domProps=o,s.update){const t=e.def.attachedRefs;if(t)for(const o of t)o&&o.domDidUpdate&&o.domDidUpdate(e.domNode,n)}}s.emptyMove&&f.updateDomChainBy(e,null,!0)}let s=n.length-1;if(s>=0){let e,t=!1;for(;e=n[s--];){const[{move:o,treeNode:n}]=e,s=n.domNode,[r,i]=s?f.findInsertionNodes(n):[null,null];if(r&&s){const d=s.nextSibling,a=r!==s.parentNode||i!==d;a&&r&&r.insertBefore(s,i);const c=n.def&&n.def.attachedRefs;c&&(a||o&&this.settings.callRefMoveEvenIfNoDomMove)&&(t=!0,e[2]=d,e[3]=c)}else!this.settings.devLogWarnings||s||r||console.warn('__UIRender.applyToDom: Error: Cannot move element: ',s,' into parent: ',r,' for treeNode: ',n)}if(t)for(s=0;e=n[s];s++){if(!e[3])continue;const[t,o,n,s]=e,r=t.treeNode.domNode;for(const e of s)t.move?e.domDidMove&&e.domDidMove(r,o,n):(U.didAttachOn(e,t.treeNode),e&&e.domDidMount&&e.domDidMount(r))}}}static findInsertionNodes(e){let t=null,o=e.parent;for(;o;){if(!(f.PASSING_TYPES[o.type]||'root'===o.type&&o.parent)){t=o.domNode;break}o=o.parent}if(!t)return[null,null];let n=null,s=e;for(;s&&(o=s.parent,o);){let e,r=o.children.indexOf(s)+1;for(;e=o.children[r];){if(e.domNode&&'portal'!==e.type){n=e.domNode;break}r++}if(n||o.domNode===t)break;s=o}return[t,n]}static updateDomChainBy(e,t,o=!1){let n=e,s=o?e:e.parent,r=t;for(;s&&f.PASSING_TYPES[s.type]&&(s.children[0]===n||s===n);){if(!r){let e,t=s.children.indexOf(n)+1;for(;e=s.children[t];){if(e.domNode&&'portal'!==e.type){r=e.domNode;break}t++}}s.domNode=r,n=s,s=s.parent}}static readFromDom(e){const t={};if(!(e instanceof Element))return t;for(const o of e.getAttributeNames())t[o]=e.getAttribute(o);return e.style.cssText&&(t.style=n.cleanHtmlStyle(e.style.cssText)),t}static domNodeFrom(e,t='div',o=!1){const n=t instanceof Element?t:document.createElement(t);return n.innerHTML=e,o||n.children[1]?n:n.children[0]}static domApplyProps(e,t=!1){const o=e.domNode,s=e.def.props||{},r=e.domProps||{},i={},d={appliedProps:i};if(!o)return d;const a=n.getDictionaryDiffs(r,s,['style','class']);if(a){d.attrDiffs=a;for(const n in a){const s=a[n],d=void 0!==s,c=f.LISTENER_PROPS[n];if(f.IGNORE_PROPS[n])t&&console.warn('__UIRender.domApplyProps: Warning: Is using an ignored dom prop: ',n,' for treeNode: ',e);else{if(c){const e=r[n];e&&o.removeEventListener(c,e),d&&o.addEventListener(c,s)}else d?o.setAttribute(n,s):o.removeAttribute(n);d?i[n]=s:delete i[n]}}}const c=r.style||s.style?n.getDictionaryDiffs(r.style||{},s.style||{}):null;if(c){d.styleDiffs=c,i.style||(i.style={});for(const e in c){const t=c[e];null==t?(o.style[e]='',delete i.style[e]):(o.style[e]=t,i.style[e]=t)}}const l=r.class!==(s.class||void 0)?n.getClassNameDiffs(r.class,s.class):null;if(l){d.classDiffs=l;for(const e in l)l[e]?o.classList.add(e):o.classList.remove(e);s.class?i.class=s.class:delete i.class}return d}}function h(e){var t;return(t=class extends e{constructor(e,t,o=null,...n){super(...n),this.props=e,this.updateMode=o,t&&(this.isMounted=()=>!0===t.isMounted,this.getChildren=t.contentApi.getChildren.bind(t.contentApi),this.needsChildren=t.contentApi.needsChildren.bind(t.contentApi))}setUpdateMode(e){this.updateMode=e}render(e){return X.Content}isMounted(){return!1}getChildren(e=!1,t=!0){return[]}needsChildren(e){}}).UI_DOM_TYPE='Mini',t}f.IGNORE_PROPS={innerHTML:!0,textContent:!0},f.PASSING_TYPES={boundary:!0,pass:!0,contexts:!0,host:!0},f.LISTENER_PROPS=['Abort','AnimationCancel','AnimationEnd','AnimationIteration','AnimationStart','AuxClick','Blur','CanPlay','CanPlayThrough','Change','Click','Close','ContextMenu','CueChange','DblClick','Drag','DragEnd','DragEnter','DragLeave','DragOver','DragStart','Drop','DurationChange','Emptied','Ended','Error','Focus','GotPointerCapture','Input','Invalid','KeyDown','KeyPress','KeyUp','Load','LoadedData','LoadedMetaData','LoadStart','LostPointerCapture','MouseDown','MouseEnter','MouseLeave','MouseMove','MouseOut','MouseOver','MouseUp','Pause','Play','Playing','PointerCancel','PointerDown','PointerEnter','PointerLeave','PointerMove','PointerOut','PointerOver','PointerUp','Progress','RateChange','Reset','Resize','Scroll','SecurityPolicyViolation','Seeked','Seeking','Select','Stalled','Submit','Suspend','TimeUpdate','Toggle','TouchCancel','TouchEnd','TouchMove','TouchStart','TransitionCancel','TransitionEnd','TransitionRun','TransitionStart','VolumeChange','Waiting','Wheel'].reduce(((e,t)=>(e['on'+t]=t.toLowerCase(),e)),{});class p extends(h(Object)){}const m=e=>function(t){return e(this,t)},y=h;function g(e){var o;return(o=class extends e{constructor(e,t,...o){super(...o),t&&(this.boundary=t),this.props=e,this.updateModes={},this.wired=null}update(e,t,o){this.boundary.uiHost.services.absorbUpdates(this.boundary,{force:e||!1},t,o)}setState(e,t,o,n){const s=Object.assign(Object.assign({},this.state),e);this.boundary.updateBy({state:s},t,o,n)}setInState(e,t,o,n,s){const r=Object.assign(Object.assign({},this.state||{}),{[e]:t});this.boundary.updateBy({state:r},o,n,s)}addTimer(e,t,o,n=!0){this._timers?this._timers.has(e)&&this.clearTimer(e):this._timers=new Map,this._timers.set(e,window.setTimeout((()=>{this.clearTimer(e),n?t.call(this):t()}),o))}hasTimer(e){return!!this._timers&&this._timers.has(e)}clearTimer(e){if(!this._timers)return;const t=this._timers.get(e);null!=t&&(window.clearTimeout(t),this._timers.delete(e))}clearTimers(e){if(this._timers)if(e)for(const t of e)this.clearTimer(t);else this._timers.forEach((e=>window.clearTimeout(e))),this._timers.clear()}isMounted(){return!0===this.boundary.isMounted}queryDomElement(e,t=!1,o=!1){return P.queryDomElement(this.boundary.baseTreeNode,e,t,o)}queryDomElements(e,t=0,o=!1,n=!1){return P.queryDomElements(this.boundary.baseTreeNode,e,t,o,n)}findDomNodes(e=0,t=!1,o=!1,n){return P.findTreeNodesWithin(this.boundary.baseTreeNode,{dom:!0},e,t,o,n).map((e=>e.domNode))}findBoundaries(e=0,t=!1,o=!1,n){return P.findTreeNodesWithin(this.boundary.baseTreeNode,{boundary:!0},e,t,o,n).map((e=>e.boundary))}findTreeNodes(e,t=0,o=!1,s=!1,r){return P.findTreeNodesWithin(this.boundary.baseTreeNode,n.buildRecordable(e),t,o,s,r)}getChildren(e=!1,t=!0){return this.boundary.contentApi&&this.boundary.contentApi.getChildren(e,t)||[]}needsChildren(e){this.boundary.contentApi&&this.boundary.contentApi.needsChildren(e)}needsData(e,t,o){return this.boundary.contextApi.needsData(e,t,o)}needsDataBy(e,t,o){return this.boundary.contextApi.needsDataBy(e,t,o)}needsAction(e,t,o){this.boundary.contextApi.needsAction(e,t,o)}needsActions(e,t=[],o){this.boundary.contextApi.needsActions(e,t,o)}needsActionsBy(e,t,o){this.boundary.contextApi.needsActionsBy(e,t,o)}setData(e,t,o,n,s){const r=this.boundary.contextApi.getContext(e);r&&r.setData(t,o,n,s)}setInData(e,t,o,n,s,r){const i=this.boundary.contextApi.getContext(e);i&&i.setInData(t,o,n,s,r)}getData(e,t){const o=this.boundary.contextApi.getContext(e);return o?o.data:t}getInData(e,t,o){const n=this.boundary.contextApi.getContext(e);return n?n.getInData(t):o}refreshData(e,t,o){const n=this.boundary.contextApi.getContext(e);n&&n.refresh(t,o)}refreshDataBy(e,t){const o=this.boundary.contextApi.getContexts(e);for(const n in o){const s=o[n];s&&s.refresh(e[n],t)}}sendAction(e,t,o,n){const s=this.boundary.contextApi.getContext(e);s&&s.sendAction(t,o,n)}sendActionWith(e,t,o,n,s){const r=this.boundary.contextApi.getContext(e);r&&r.sendAction({type:t,payload:o},n,s)}askQuestion(e,t,o){const n=this.boundary.contextApi.getContext(e);return n?n.askQuestion(t,o):void 0===o?t.value:o}askQuestionWith(e,t,o,n,s=0){const r=this.boundary.contextApi.getContext(e);return r?r.askQuestion({type:t,payload:o,value:n},s):[]}askQuestionary(e,t,o=0){const n=this.boundary.contextApi.getContext(e);return n?n.askQuestionary(t,o):t.values||[]}askQuestionaryWith(e,t,o,n=0){const s=this.boundary.contextApi.getContext(e);return s?s.askQuestionary({type:t,payload:o,values:[]},n):[]}hasContext(e,o=t.All){return!!this.boundary.contextApi.getContext(e,o)}getContext(e,o=t.All){return this.boundary.contextApi.getContext(e,o)}getContexts(e,t){return this.boundary.contextApi.getContexts(e,t)}overrideContext(e,t,o=!0){this.boundary.contextApi.overrideContext(e,t,o)}overrideContexts(e,t=!0){this.boundary.contextApi.overrideContexts(e,t)}createContext(e,t,o=!0){const n=X.createContext(e);return t&&this.boundary.contextApi.overrideContext(t,n,o),n}createContexts(e,t=!1,o=!0){const n=X.createContexts(e);return t&&this.boundary.contextApi.overrideContexts(n,o),n}createWired(e,t,o,...n){const s=X.createWired(e,t,o,...n);return this.wired?this.wired.add(s):this.wired=new Set([s]),s}render(){return X.Content}}).UI_DOM_TYPE='Live',o}class D extends(g(Object)){constructor(e,t,...o){super(e,t,...o)}}const C=e=>(t,o)=>e(o,t),v=e=>(t,o)=>e(o,t),x=g;class b{constructor(e){this.boundary=e,this.actionNeeds=new Map,this.contextNeeds=new Map}needsAction(e,t,o=!0){const n=this.actionNeeds.get(e);if(!0===n)return;const s=this.getContext(e);o?(n?n.add(t):this.actionNeeds.set(e,new Set([t])),s&&s.services.onInterest('actions',this.boundary,e)):n&&n.has(t)&&(n.delete(t),n.size||(this.actionNeeds.delete(e),s&&s.services.onDisInterest('actions',this.boundary,e)))}needsActions(e,t=[],o=!0){const n=this.actionNeeds.get(e);if('boolean'==typeof t)t?this.actionNeeds.set(e,!0):this.actionNeeds.delete(e);else if(o&&this.actionNeeds.size){if(t.length)if(n){if(!0!==n)for(const e of t)n.add(e)}else this.actionNeeds.set(e,new Set(t))}else t.length?this.actionNeeds.set(e,new Set(t)):this.actionNeeds.delete(e);if(!t!=!n){const o=this.getContext(e);o&&(t?o.services.onInterest('actions',this.boundary,e):o.services.onDisInterest('actions',this.boundary,e))}}needsActionsBy(e,t,o=!0){if(!o){const t=this.boundary.contextApi.actionNeeds;for(const o of t.keys())void 0===e[o]&&t.delete(o)}for(const o in e)this.boundary.contextApi.needsActions(o,e[o],t)}needsData(e,t=!0,o=!0){const n=!!this.contextNeeds.get(e);if(!1===t?this.contextNeeds.delete(e):this.contextNeeds.set(e,'string'==typeof t?[t]:t),n!==!t)return!1;const s=this.getContext(e)||null;return s&&(t?s.services.onInterest('data',this.boundary,e):s.services.onDisInterest('data',this.boundary,e)),o&&this.updateRemote(),!0}needsDataBy(e,t=!0,o=!0){if(!t&&this.contextNeeds.size){e=Object.assign({},e);for(const t of this.contextNeeds.keys())void 0===e[t]&&(e[t]=!1)}let n=!1;for(const t in e)this.needsData(t,e[t],!1)&&(n=!0);return n&&o&&this.updateRemote(),n}overrideContext(e,o,n=!0){const s=this.getContext(e),r=void 0!==o?o:this.getContext(e,t.Parent|t.Cascading);let i=this.overriddenContexts;void 0===o?i&&(delete i[e],Object.keys(i).length||delete this.overriddenContexts):(i||(i=this.overriddenContexts={}),i[e]=o);const d=s!==r?P.helpUpdateContext(this.boundary,e,r||null,s||null):0;return n&&P.shouldUpdateContextually(d)&&this.updateRemote(),d}overrideContexts(e,t=!0){let o=0;for(const t in e)o|=this.overrideContext(t,e[t],!1);return t&&P.shouldUpdateContextually(o)&&this.updateRemote(),o}getContext(e,o=t.All){if(o&t.Overridden){const t=this.overriddenContexts;if(t&&void 0!==t[e])return t[e]}if(o&t.Parent){const t=this.boundary._outerDef.attachedContexts;if(t&&void 0!==t[e])return t[e]}if(o&t.Cascading)return this.boundary.outerContexts[e]}getContexts(e,o=t.All){const s=e?n.buildRecordable(e):null,r={};if(o&t.Cascading)for(const e in this.boundary.outerContexts)s&&!s[e]||(r[e]=this.boundary.outerContexts[e]);if(o&t.Parent){const e=this.boundary._outerDef.attachedContexts;if(e)for(const t in e)s&&!s[t]||(r[t]=e[t])}if(o&t.Overridden){const e=this.overriddenContexts;if(e)for(const t in e)s&&!s[t]||(r[t]=e[t])}return r}updateRemote(e,t){this.boundary.isMounted?this.boundary.uiHost.services.absorbUpdates(this.boundary,{contextual:!0},e,t):this.contextNeeds.size&&this.rebuildRemote()}rebuildRemote(){const e={},t={},o=this.boundary.contextApi.overriddenContexts,n=this.boundary._outerDef.attachedContexts;for(const s of this.contextNeeds.keys()){let r=o?o[s]:void 0;n&&void 0===r&&(r=n[s]),void 0===r&&(r=this.boundary.outerContexts[s]),t[s]=r||null,e[s]=r?r.data:null}const s=this.boundary.live;s.buildRemote&&(s.remote=s.buildRemote(e,t))}}class N{constructor(e){e&&(this.readChildren=e)}readChildren(e){return null}getChildren(e=!1,t=!0){return e||'boolean'==typeof this.childrenNeeds||(this.childrenNeeds='temp'),this.readChildren(t)}needsChildren(e){null==e?delete this.childrenNeeds:this.childrenNeeds=e}}class T{constructor(e,t){this.thruBoundary=e,this.sourceBoundary=t||null,this.envelope=null,this.truePassDef=null,this.groundedDefsMap=new Map,this.pendingDefs=new Set}contentGrounded(e,t,o,n){if(this.groundedDefsMap.get(e)){if('moved'===e.action&&o.boundary){return[o.boundary.getTreeNodesForDomRoots(!0).map((e=>({treeNode:e,move:!0}))),[]]}return[[],[]]}return this.groundedDefsMap.set(e,[t,o,n]),this.applyContentDefs([e])}contentUngrounded(e){const t=this.groundedDefsMap.get(e);if(!t)return[[],[]];this.truePassDef===e&&(this.truePassDef=null),this.groundedDefsMap.delete(e),this.pendingDefs.delete(e);const o=t[1].boundary;return o?P.destroyBoundary(o):[[],[]]}preRefresh(e){if(!this.envelope&&!e)return[];const t=this.envelope?this.envelope.targetDef.childDefs.slice():[];this.envelope=e,this.pendingDefs=new Set(this.groundedDefsMap.keys());const o=[];for(const[e]of this.groundedDefsMap.values()){let n=e;for(;n;){const e=n.contentApi;if(e&&(e.childrenNeeds&&(o.push(n),n._preUpdates?n._preUpdates.children||(n._preUpdates.children=t):n._preUpdates={children:t}),!n.closure.envelope))break;if(n=n.sourceBoundary,n===this.sourceBoundary)break}}return o[0]&&o.reverse(),o}applyRefresh(e=!1){let t=[],o=[];if(this.pendingDefs.size&&([t,o]=this.applyContentDefs(this.pendingDefs,e)),!this.truePassDef&&this.envelope){const e=this.thruBoundary.uiHost.settings.devLogCleanUp;for(const n of this.envelope.appliedDef.childDefs){const s=n.treeNode;if(s){if(e&&console.log('__UIContentClosure.applyRefresh dev-log - clean up treeNode (no true pass): ',s),'dom'===s.type)t.push({treeNode:s,remove:!0});else if(s.boundary){const[e,n]=P.destroyBoundary(s.boundary);t=t.concat(e),o=o.concat(n)}s.parent=null,s.sourceBoundary=null,delete n.treeNode}}}return[t,o]}applyContentDefs(e,t=!1){e||(e=this.groundedDefsMap.keys());let o=[],n=[];for(const s of e){this.pendingDefs.delete(s);const e=this.groundedDefsMap.get(s);if(void 0===e)continue;let[r,i,d]=e,a=i.boundary;if(this.envelope&&this.sourceBoundary){let e=!0;a?(e=this.truePassDef===s,a.updateEnvelope(this.envelope.targetDef,e?this.envelope.appliedDef:null)):(a=new A(s,this.envelope.targetDef,i,this.sourceBoundary),e=null==d&&(!this.truePassDef||this.truePassDef===s),e&&(a._innerDef.childDefs=this.envelope.appliedDef.childDefs,this.truePassDef=s),a.parentBoundary=r,i.boundary=a);const[c,l]=e?P.runContentPassUpdate(a,t):P.runBoundaryUpdate(a,t);o=o.concat(c),n=n.concat(l)}else a&&(o=o.concat(P.destroyBoundary(a,!1)[0]),i.boundary=null)}return[o,n]}}class _{constructor(e,t,o){this.uiHost=e,this.baseTreeNode=o,this._outerDef=t,this._innerDef=null,this.isMounted=!1,this.sourceBoundary=null,this.parentBoundary=null,this.innerBoundaries=[],this.outerContexts={}}getRootTreeNodes(){return[...this.baseTreeNode.children]}getTreeNodesForDomRoots(e=!1,t=!1){return P.getTreeNodesForDomRootsUnder(this.baseTreeNode,e,t)}getRootDomNode(){return this.baseTreeNode.domNode}getRootDomNodes(e=!1){return P.getTreeNodesForDomRootsUnder(this.baseTreeNode,e,!1).map((e=>e.domNode))}getAllDomNodes(e=!0,t=!1){if(!this._innerDef)return[];const o=[];let n,s=[this._innerDef],r=0;for(;n=s[r];){if(r++,n.treeNode){const o=n.treeNode.type;if('host'===o)continue;if(!e&&'boundary'===o)continue;if(!t&&'pass'===o)continue}n.childDefs[0]&&(s=n.childDefs.concat(s.slice(r)),r=0),n.treeNode&&'dom'===n.treeNode.type&&n.treeNode.domNode&&o.push(n.treeNode.domNode)}return o}}class A extends _{constructor(e,t,o,n){super(n.uiHost,e,o),this.sourceBoundary=n,this.targetDef=t,this._innerDef=r.newAppliedDefBy(t,n.closure)}updateEnvelope(e,t){this.targetDef=e,t&&(this._innerDef.childDefs=t.childDefs)}}class w extends _{constructor(e,t,o,n){super(e,t,o),this._notRendered=!0,this.uiId=e.services.createBoundaryId(),this.sourceBoundary=n||null,this.closure=new T(this,n),this.reattach(!1)}reattach(e=!0){e&&(delete this.contextApi,delete this.contentApi,delete this.live,delete this.mini),this.type='';let t=this._outerDef.tag;if('function'==typeof t){let e=null,o=null,n=null;switch(t.UI_DOM_TYPE){case void 0:t.length<2?(this.type='mini',e=p,n=this._outerDef.tag):(this.type='live',o=D,n=this._outerDef.tag);break;case'Live':this.type='class-live',o=t;break;case'Mini':this.type='class-mini',e=t,n=this._outerDef.tag;break;case'Wired':this.type='class-wired',e=t}const s=o||e?(e=!0)=>{var t;const o=(null===(t=this.closure.envelope)||void 0===t?void 0:t.targetDef.childDefs)||null;return o&&(e?o.slice():o)}:null;if(o&&(this.contentApi=new N(s),this.contextApi=new b(this),this.live=new o(this._outerDef.props||{},this),n&&(this.live.render=n)),e&&(this.contentApi=new N(s),this.mini=new e(this._outerDef.props||{},this),n&&(this.mini.render=n),'class-wired'===this.type)){const t=e;t.boundaries.add(this),t.uiWillMount&&t.uiWillMount(this)}}}update(e,t,o){this.uiHost.services.absorbUpdates(this,{force:this.isMounted?e||!1:'all'},t,o)}updateBy(e,t,o,n){this.uiHost.services.absorbUpdates(this,Object.assign(Object.assign({},e),{force:this.isMounted?t||!1:'all'}),o,n)}render(e=0){let t;e||(this._renderState='active'),this.contentApi&&'temp'===this.contentApi.childrenNeeds&&delete this.contentApi.childrenNeeds;const o=this._outerDef.props||{};if(this.mini?t=this.mini.render(o):this.live&&(t='live'===this.type?this.live.render(o,this.live):this.live.render()),'function'==typeof t)return this.mini?this.mini.render=t:this.live&&(this.live.render=t),this.render(e);if(this._notRendered){delete this._notRendered;const e=this.live;if(e&&e.onContextChange&&e.render.length>1){const t=e.getContexts();for(const o in t)e.onContextChange(o,t[o],null)}}if('re-updated'===this._renderState){const t=this.uiHost.settings.maxReRenders;if(t<0||e<t)return e++,this._renderState='active',this.render(e);this.uiHost.settings.devLogWarnings&&console.warn('__UISourceBoundary.render: Warning: The boundary tried to render for over '+(e+1).toString()+' times.','class-live'===this.type&&this.live&&this.live.constructor||('class-wired'===this.type||'class-mini'===this.type)&&this.mini&&this.mini.constructor||this._outerDef.tag,this)}return delete this._renderState,t}}const P={SEARCH_TAG_BY_TYPE:{fragment:1,portal:2,pass:3,contexts:4,host:5},runContentPassUpdate(e,t=!1){const[o,n,s]=P.assignTreeNodesForPass(e);let[r,i]=P.applyDefPairs(e,o,t);if(n[0]){const t=new Set;for(const e of n)e.sourceBoundary||(e.def&&t.add(e.def),e.parent=null);if(t.size){r=P.cleanUpBoundaryDefs(t,e.uiHost.settings.devLogCleanUp).concat(r)}}return s[0]&&(r=s.map((e=>({treeNode:e,emptyMove:!0}))).concat(r)),e.isMounted=!0,[r,i]},runBoundaryUpdate(e,t=!1){let o=null,n=e._innerDef;e.uiId?(o=r.createDefFromContent(e.render()),o&&!n&&(n=r.newAppliedDefBy(o,e.closure))):o=e.targetDef;const[s,i]=n?P.buildDefMaps(n):[new Map,new Set];let d,a;const c=[];if(o){const r=[],l=P.pairDefs(e,o,n,s,i,r,c);e._innerDef=l[0][1];const u=P.applyDefPairs(e,l,t);if(d=u[0],a=u[1],r[0])for(const e of r){const t=e.treeNode;t&&null===t.sourceBoundary&&i.add(e)}}else d=[{treeNode:e.baseTreeNode,emptyMove:!0}],a=[],e.innerBoundaries=[],e.baseTreeNode.children=[],e._innerDef=null;if(i.size){d=P.cleanUpBoundaryDefs(i,e.uiHost.settings.devLogCleanUp).concat(d)}return c[0]&&(d=c.map((e=>({treeNode:e,emptyMove:!0}))).concat(d)),e.isMounted||(e.isMounted=!0),delete e._outerContextsWere,[d,a]},applyDefPairs(t,o,s=!1){const r=t.uiId?t:t.sourceBoundary,i=[],d=t.uiHost.settings.preEqualCheckDomProps;t.innerBoundaries=[];let a=[],c=[];for(const l of o){const[o,u,f,h]=l,p='mounted'===u.action;if(!p&&'moved'===u.action)switch(u._uiDefType){case'contexts':case'fragment':for(const e of P.getTreeNodesForDomRootsUnder(f,!0,!0))-1===i.indexOf(e)&&(i.push(e),a.push({treeNode:e,move:!0}));break;case'host':u.host&&u.host.groundedTree.parent===f&&a.push({treeNode:f,move:!0})}if('fragment'===u._uiDefType)continue;if('pass'===f.type){if('pass'!==u._uiDefType)continue;if(u.contentPass){const[e,o]=u.contentPass.contentGrounded(u,t,f,u.key!==V.key?u.key:null);a=a.concat(e),c=c.concat(o)}f.boundary&&t.innerBoundaries.push(f.boundary);continue}const m=u.props;let y=!1;switch(o.props&&u.props!==o.props&&(f.boundary&&P.preSetUpdates(f.boundary,{props:o.props}),u.props=o.props||{}),u._uiDefType){case'content':const e=o.domHtmlMode;y=u.domContent!==o.domContent||e!==o.domHtmlMode,y&&(u.domContent=o.domContent,void 0!==e?u.domHtmlMode=e:delete u.domHtmlMode);break;case'element':u.domElement!==o.domElement&&(p||a.push({treeNode:f,swap:!0}),u.domElement=o.domElement||null),u.domCloneMode=null!=o.domCloneMode?o.domCloneMode:null;break;case'portal':u.domPortal!==o.domPortal&&(p||a.push({treeNode:f,swap:!0}),u.domPortal=o.domPortal||null);break;case'contexts':{const e=u.contexts,t=o.contexts||null;if(e!==t){if(e)for(const o in e){const n=e[o];if(n&&n!==(t&&t[o]||null)){n.onRemoveFrom&&n.onRemoveFrom(f,o);const e=n.inTree.get(f);e&&e.size>1?e.delete(o):n.inTree.delete(f)}}for(const o in t){const n=t[o];if(n&&n!==(e&&e[o]||null)){n.onInsertInto&&n.onInsertInto(f,o);const e=n.inTree.get(f);e?e.add(o):n.inTree.set(f,new Set([o]))}}u.contexts=t}break}}switch(o._uiDefType){case'dom':case'content':case'element':if(p)a.push({treeNode:f,create:!0});else{const e='moved'===u.action&&-1===i.indexOf(f),t=!!u.tag&&(!d||'if-needed'===d&&(y||e)||!n.equalDomProps(m||{},o.props||{}));if(t||y||e){const o={treeNode:f};t&&(o.update=!0),y&&(o.content=!0),e&&(o.move=!0,i.push(f)),a.push(o)}}break;case'boundary':if(p){const e=new w(t.uiHost,u,f,r);e.parentBoundary=t,e.outerContexts=Object.assign({},h),f.boundary=e}break;case'portal':p&&a.push({treeNode:u.treeNode,create:!0});break;case'host':u.host&&null===u.host.groundedTree.parent&&(u.host.groundedTree.parent=f,f.children=[u.host.groundedTree],a.push({treeNode:f,move:!0}),u.host.settings.welcomeContextsUpRoot&&u.host.services.onContextPass(h))}if((u.attachedRefs||o.attachedRefs)&&P.handleAttachedRefs(u,o),(u.attachedContexts||o.attachedContexts)&&P.handleAttachedContexts(u,o),f.boundary){const n=f.boundary;t.innerBoundaries.push(n);let r=null;if(o.childDefs[0]){const e=n.closure.envelope;r=e?{appliedDef:Object.assign(Object.assign({},e.appliedDef),{childDefs:u.childDefs,action:u.action}),targetDef:Object.assign(Object.assign({},e.targetDef),{childDefs:o.childDefs})}:{appliedDef:{tag:null,_uiDefType:'fragment',childDefs:u.childDefs,action:'mounted'},targetDef:{tag:null,_uiDefType:'fragment',childDefs:o.childDefs}}}let d=n.closure.preRefresh(r);const l=d.length;if(!p){let t=0;const o=n.contextApi;for(const s in n.outerContexts){const r=n.outerContexts[s];h[s]===r||o&&void 0!==o.getContext(s)||(t|=e.Otherwise,o&&(t|=P.helpUpdateContext(n,s,h[s]||null,r)))}for(const s in h){if(void 0!==n.outerContexts[s])continue;const r=h[s];n.outerContexts[s]===r||o&&void 0!==o.getContext(s)||(t|=e.Otherwise,o&&(t|=P.helpUpdateContext(n,s,r,null)))}t&&(n._outerContextsWere=n.outerContexts,n.outerContexts=Object.assign({},h),o&&P.shouldUpdateContextually(t)&&(n._preUpdates||(n._preUpdates={}),n._preUpdates.contextual=!0))}const m=t.uiHost.services.updateBoundary(n,s,i,d);if(m&&(a=a.concat(m[0]),c=c.concat(m[1])),n._outerContextsWere){const e=P.afterOuterContexts(n);if(e[0])if(d[0])for(const t of e)-1===d.indexOf(t)&&d.push(t);else d=e}if(u.attachedRefs)for(const e of u.attachedRefs)U.didAttachOn(e,f);if(d[0]){const e=P.updateInterested(d,d[1]&&l!==d.length||!1);a=a.concat(e[0]),c=c.concat(e[1])}const y=n.closure.applyRefresh(s);a=a.concat(y[0]),c=c.concat(y[1])}}return[a,c]},pairDefs(e,t,o,n,s,r,i){const d=e.uiHost.settings,a=[],c=e.uiId?e:e.sourceBoundary;let l,u=[[{childDefs:[t]},{childDefs:[o]},e.baseTreeNode,Object.assign({},e.outerContexts),!1]],f=0;for(;l=u[f];){f++;const[e,t,o,h,p]=l;if(e.childDefs[0]){const a=P.findAppliedChildDefs(t,e,n,s,c,d);t.childDefs=a;const l=o&&'boundary'!==e._uiDefType&&('element'!==e._uiDefType||e.domElement)?P.assignTreeNodesForChildren(a,o,p,c,i):[],m=[];for(let t,o=0;t=e.childDefs[o];o++){const e=l[o],n=a[o];!e&&n.treeNode&&(n.treeNode.sourceBoundary=null,r&&r.push(n));const s=t.contexts?P.mergeOuterContexts(h,t.contexts):h;m.push([t,n,l[o]||null,s,'fragment'===t._uiDefType])}u=m.concat(u.slice(f)),f=0}else t.childDefs=[];o&&e._uiDefType&&t._uiDefType&&a.push([e,t,o,h])}return a},findAppliedChildDefs(e,t,o,n,s,i){let d=t.childDefs.length;if(!d)return[];const a=!!i&&i.wideKeysInArrays,c=a||!t.isArray;if(!a&&t.isArray!=(e&&e.isArray))return t.childDefs.map((e=>r.newAppliedDefBy(e,s&&s.closure||null)));const l=!i||i.reuseSiblingTags,u=!!i&&i.noRenderValuesMode,f=e&&e.childDefs.slice()||null,h=[];for(let i=0;i<d;i++){const a=t.childDefs[i];let p=!1;if(u&&'content'===a._uiDefType?p=!0===u?!a.domContent:-1!==u.indexOf(a.domContent):'fragment'===a._uiDefType&&a.withContent&&(p=!s||!s.closure.envelope),p){t.childDefs.splice(i,1),d--,i--;continue}const m=null!=a.key,y=P.SEARCH_TAG_BY_TYPE[a._uiDefType]||a.tag;let g=null;if(f&&(m||l)){let e=-1;for(const t of f){e++;if((P.SEARCH_TAG_BY_TYPE[t._uiDefType]||t.tag)===y&&(m?t.key===a.key:null==t.key)&&n.has(t)&&(m||!0===l||!t.tag||'string'==typeof t.tag||!('dom'===l||'dom-mini'===l&&(t.tag.UI_DOM_TYPE?'Mini'!==t.tag.UI_DOM_TYPE:t.tag.length>=2)))){g=t,f.splice(e,1),n.delete(t);break}}}if(!g&&m&&c){const e=o&&o.get(y);if(e){let t=-1;for(const o of e)if(t++,o.key===a.key&&o.keyScope===a.keyScope&&n.has(o)){g=o,n.delete(o),e.splice(t,1);break}}}g?g.action=e&&e.childDefs[i]===g?'updated':'moved':g=r.newAppliedDefBy(a,s&&s.closure||null),h.push(g)}return h},assignTreeNodesForChildren(e,t,o,n,s){t.children[0]&&(t.children=[]);const r=e.length;if(!r)return[];const i=[];let d=0,a=null,c=t;if(o){if(!t.parent)return[];if(c=t.parent,a=t,d=c.children.indexOf(t),-1===d)return[]}for(let t=0;t<r;t++){const o=e[t];let r=null;o.treeNode?r=o.treeNode:'fragment'!==o._uiDefType&&(o.action='mounted'),a&&(r?c.children.splice(d,1):r=a,a=null);const l=o._uiDefType,u='content'===l||'element'===l?'dom':'fragment'===l?'':l;if(r){if(r.parent){const e=r.parent.children.indexOf(r);0===e&&r.parent!==c&&!0===f.PASSING_TYPES[r.parent.type]&&s&&-1===s.indexOf(r.parent)&&s.push(r.parent),-1!==e&&r.parent.children.splice(e,1)}r.parent=c,r.sourceBoundary=n||null,r.type=u}else r={type:u,parent:c,children:[],sourceBoundary:n||null,domNode:null},'dom'===r.type&&(r.domProps={});'fragment'!==o._uiDefType&&(r.def=o,o.treeNode=r),c.children.splice(d+t,0,r),i.push(r)}return i},assignTreeNodesForPass(e){const t=e._innerDef,o=e.sourceBoundary,n=[],s=[],r=[];let i,d=[[e.targetDef,t,e.baseTreeNode,Object.assign({},e.outerContexts),!1]],a=0;for(;i=d[a];){a++;const[e,t,c,l,u]=i;if(e.childDefs[0]){const r=c&&'boundary'!==e._uiDefType&&('element'!==e._uiDefType||e.domElement)?P.assignTreeNodesForChildren(t.childDefs,c,u,o,s):[];let i=0;const f=[];for(const o of t.childDefs){const t=r[i];!t&&o.treeNode&&(n.push(o.treeNode),o.treeNode.sourceBoundary=null);const s=e.childDefs[i],d=s.contexts?P.mergeOuterContexts(l,s.contexts):l;f.push([s,o,t,d,'fragment'===o._uiDefType]),i++}d=f.concat(d.slice(a)),a=0}c&&r.push([e,t,c,l])}return[r,n,s]},buildDefMaps(e){const t=new Set,o=new Map;let n,s=[e],r=0;for(;n=s[r];){r++,t.add(n);const e=P.SEARCH_TAG_BY_TYPE[n._uiDefType]||n.tag,i=o.get(e);i?i.push(n):o.set(e,[n]),n.childDefs[0]&&(s=n.childDefs.concat(s.slice(r)),r=0)}return[o,t]},cleanUpBoundaryDefs(e,t=!1){t&&console.log('___Apply.cleanUpBoundaryDefs: Dev-log: Clean up unused defs: ',[...e]);let o=[];for(const t of e){const e=t.treeNode;if(e){switch(t._uiDefType){case'dom':case'element':case'content':o.push({treeNode:e,remove:!0});break;case'boundary':e.boundary&&(o=o.concat(P.destroyBoundary(e.boundary,!1)[0]));break;case'pass':t.contentPass&&(o=o.concat(t.contentPass.contentUngrounded(t)[0]));case'host':t.host&&t.host.groundedTree.parent===e&&(t.host.groundedTree.parent=null,e.children=[],o.push({treeNode:e,move:!0}));case'contexts':if(t.contexts)for(const o in t.contexts){const n=t.contexts[o];if(!n)continue;n.onRemoveFrom&&n.onRemoveFrom(e,o);const s=n.inTree.get(e);s&&s.size>1?s.delete(o):n.inTree.delete(e)}default:if(t.attachedRefs&&t._uiDefType)for(const o of t.attachedRefs)U.willDetachFrom(o,e)}e.parent=null,e.sourceBoundary=null,delete t.treeNode}}return o},destroyBoundary(e,t=!0,o=!0){let n=[];const s=P.findBoundariesWithin(e,!0);for(const e of s){if(null===e.isMounted)continue;const s=e.uiId?e:null;if(s){const e=s.live;if(e){e.uiWillUnmount&&e.uiWillUnmount(),e.clearTimers();const t=s,o=t.contextApi.getContexts();for(const e in o){const n=o[e];n&&P.helpUpdateContext(t,e,null,n)}}if(s.mini){const e=s.mini,t=e.constructor;e.uiWillUnmount&&e.uiWillUnmount(),'Wired'===t.UI_DOM_TYPE&&(t.uiWillUnmount&&t.uiWillUnmount(s),t.boundaries.delete(s))}}const r=o?e.getTreeNodesForDomRoots(!1):[];if(e._innerDef&&e._innerDef.childDefs[0]){let n,i=[e._innerDef],d=0;for(;n=i[d];){d++,n.childDefs[0]&&(i=n.childDefs.concat(i.slice(d)),d=0);const e=n.treeNode;if(e){const i='dom'===e.type;if(n.attachedRefs)for(const t of n.attachedRefs)i?o&&-1===r.indexOf(e)&&r.push(e):t.uiWillUnmount&&e.boundary&&'boundary'===e.type&&t.uiWillUnmount(e.boundary),U.willDetachFrom(t,e);i&&!s&&t&&(e.sourceBoundary=null,e.parent=null,delete n.treeNode)}}}if(e._outerDef.attachedRefs)for(const t of e._outerDef.attachedRefs)s&&t.uiWillUnmount&&t.uiWillUnmount(s),U.willDetachFrom(t,e.baseTreeNode);s&&s.uiHost.services.cancelUpdates(s),o&&(n=n.concat(r.map((e=>({treeNode:e,remove:!0}))))),e.isMounted=null}return[n,[]]},handleAttachedRefs(e,t){const o=e.treeNode;if(e.attachedRefs&&o)for(const n of e.attachedRefs)t.attachedRefs&&-1!==t.attachedRefs.indexOf(n)||U.willDetachFrom(n,o);e.attachedRefs=t.attachedRefs},handleAttachedContexts(t,o){if(!t.treeNode||!t.attachedContexts&&!o.attachedContexts)return;const n=t.treeNode,s='boundary'===n.type&&n.boundary||null,r=t.attachedContexts||{};t.attachedContexts=o.attachedContexts;const i=s&&s.contextApi;if(i&&(i.actionNeeds||i.contextNeeds.size)){const t=i.overriddenContexts||{},n=o.attachedContexts||{},d=new Set([...Object.keys(r),...Object.keys(n)]);let a=0;for(const o of d){if(void 0!==t[o])continue;const i=void 0===r[o]?s.outerContexts[o]:r[o],d=n[o];d!==i&&(a|=e.Otherwise,a|=P.helpUpdateContext(s,o,d,i))}P.shouldUpdateContextually(a)&&(s._preUpdates||(s._preUpdates={}),s._preUpdates.contextual=!0)}},helpUpdateContext(t,o,n,s){let r=0;if(t.contextApi.contextNeeds.has(o)&&(s&&s.services.onDisInterest('data',t,o),n&&n.services.onInterest('data',t,o),r|=e.Data),t.contextApi.actionNeeds.has(o)&&(s&&s.services.onDisInterest('actions',t,o),n&&n.services.onInterest('actions',t,o),r|=e.Actions),t.live.onContextChange){const i=t.live.onContextChange(o,n,s);null!==i&&(r|=i?e.DoRefresh:e.NoRefresh)}return r},mergeOuterContexts(e,t){const o=Object.assign({},e);for(const e in t){const n=t[e];n?o[e]=n:delete o[e]}return o},afterOuterContexts(t){const o=[];if(!t._outerContextsWere)return o;const n={},s=t.outerContexts;for(const e in t.outerContexts){const o=t._outerContextsWere[e];t.outerContexts[e]!==o&&(n[e]=o)}for(const e in t._outerContextsWere)void 0===t.outerContexts[e]&&(n[e]=t._outerContextsWere[e]);t.outerContexts=t._outerContextsWere,delete t._outerContextsWere;let r,i=[[t.baseTreeNode,n]],d=0;for(;r=i[d];){d++;const t=r[0],n=r[1];if('host'===t.type){const e=t.def.host;if(e&&e.settings.welcomeContextsUpRoot){const t=e.rootBoundary,o=Object.assign({},t.outerContexts);let r=!1;for(const e in n)if(t.outerContexts[e]===n[e]){r=!0;const t=s[e];t?o[e]=t:delete o[e]}r&&e.services.onContextPass(o)}}else if(t.boundary){const r=t.boundary,a={};let c=0;for(const t in n)if(r.outerContexts[t]===n[t]){const n=s[t],i=a[t];if(n?r.outerContexts[t]=n:delete r.outerContexts[t],a[t]=i,c|=e.Otherwise,r.contextApi){if(n!==r.contextApi.getContext(t))continue;c|=P.helpUpdateContext(r,t,n,i),void 0!==r.contextApi.contextNeeds.get(t)&&-1===o.indexOf(r)&&o.push(r)}}if(delete r._outerContextsWere,!c)continue;r.uiId&&P.shouldUpdateContextually(c)&&(r._preUpdates||(r._preUpdates={}),r._preUpdates.contextual=!0),t.children[0]&&(i=t.children.map((e=>[e,a])).concat(i.slice(d)),d=0)}else if(t.children[0]){const e='contexts'===t.type?t.def.contexts:null;let o=n;if(e){const t=[];for(const o in n)void 0!==e[o]&&t.push(o);if(t[0]){o=Object.assign({},n);for(const e of t)delete o[e];void 0===Object.keys(o)[0]&&(o=null)}}o&&(i=t.children.map((e=>[e,o])).concat(i.slice(d)),d=0)}}return o},shouldUpdateContextually:t=>0==(t&e.NoRefresh)&&0!=(t&(e.DoRefresh|e.Data)),shouldUpdateBy(e,t,o){const s=e.uiHost.settings,r=e.live?e.live.updateModes:{props:e.mini&&(e.mini.updateMode||e.mini.constructor.updateMode)||s.updateMiniMode};let i=!1;if(t)for(const e in t){i=!0;switch(r[e]||s.updateLiveModes[e]){case'always':return!0;case'changed':if(t[e]!==o[e])return!0;break;case'shallow':if(!n.areEqual(t[e]||{},o[e],1))return!0;break;case'double':if(!n.areEqual(t[e]||{},o[e],2))return!0;break;case'deep':if(!n.areEqual(t[e]||{},o[e],-1))return!0}}return!i&&(e.mini?'always'===s.updateMiniMode:s.shouldUpdateWithNothing)},preSetUpdates(e,t){const o=e.live;let n=e._preUpdates;n||(e._preUpdates=n={}),t.props&&(n.props||(n.props=e._outerDef.props||{}),e._outerDef.props=t.props,o?o.props=t.props:e.mini&&(e.mini.props=t.props)),t.state&&o&&(n.state||(n.state=o.state),o.state=t.state),t.children&&e.closure&&(n.children||(n.children=e.closure.envelope?e.closure.envelope.targetDef.childDefs.slice():[])),t.contextual&&o&&(n.contextual||(n.contextual=!0)),t.force&&(n.force='all'!==t.force&&'all'!==n.force||'all')},sortBoundaries(e){const t=new Map;for(const o of e){let e=o.uiId,n=o.parentBoundary;for(;n;)e=(n.uiId||'')+'>'+e,n=n.parentBoundary;const s=t.get(e);if(s){let e=0;if(o.parentBoundary){const t=o.parentBoundary.innerBoundaries,n=t.indexOf(o);for(const o of s){if(n<t.indexOf(o))break;e++}}s.splice(e,0,o)}else t.set(e,[o])}const o=[];for(const e of t.keys()){let t=0,n=!1;for(const s of o){if(s.startsWith(e+'>'))break;if(e.startsWith(s+'>'))n=!0;else if(n)break;t++}o.splice(t,0,e)}let n=0;for(const s of o)for(const o of t.get(s))e[n]=o,n++},updateInterested(e,t=!0){let o=[],n=[];t&&P.sortBoundaries(e);for(const t of e){if(!t._preUpdates)continue;const e=t.uiHost.services.updateBoundary(t);e&&(o=o.concat(e[0]),n=n.concat(e[1]))}return[o,n]},refreshWithTimeout(e,t,o,n,s){null!==o&&void 0!==s&&(window.clearTimeout(o),o=null);const r=void 0===s?n:s;return null===r?t.call(e):null===o&&(o=window.setTimeout((()=>t.call(e)),r)),o},findBoundariesWithin(e,t=!0){const o=[];let n,s=[e],r=0;for(;n=s[r];)r++,null!==n.isMounted&&(o.push(n),(t||e===n)&&n.innerBoundaries[0]&&(s=n.innerBoundaries.concat(s.slice(r)),r=0));return o},findTreeNodesWithin(e,t,o=0,n=!1,s=!1,r){const i=[];let d,a=[e],c=0;const l=e.boundary;for(;d=a[c];)if(c++,!d.boundary||null!==d.boundary.isMounted){if(t[d.type]&&(!r||r(d))){const e=i.push(d);if(o&&e>=o)return i}d.boundary&&!n&&d.boundary!==l||('host'!==d.type||s)&&d.children[0]&&(a=d.children.concat(a.slice(c)),c=0)}return i},queryDomElement(e,t,o=!1,n=!1){const s=P.findTreeNodesWithin(e,{dom:!0},1,o,n,(e=>e.domNode&&e.domNode instanceof Element&&e.domNode.matches(t)))[0];return s&&s.domNode||null},queryDomElements:(e,t,o=0,n=!1,s=!1)=>P.findTreeNodesWithin(e,{dom:!0},o,n,s,(e=>e.domNode&&e.domNode instanceof Element&&e.domNode.matches(t))).map((e=>e.domNode)),findTreeNodes:(e,t,o=0,s=!1,r=!1,i)=>P.findTreeNodesWithin(e,n.buildRecordable(t),o,s,r,i),getTreeNodesForDomRootsUnder(e,t=!1,o=!1,n=0){let s=[];for(const r of e.children)if(r.domNode||o)switch(r.type){case'dom':if(s.push(r),n&&s.length>=n)return s;break;case'boundary':case'pass':case'host':if(!t)break;case'contexts':case'root':if(s=s.concat(P.getTreeNodesForDomRootsUnder(r,t,o,n-s.length)),n&&s.length>=n)return s.slice(0,n)}return s}};function M(e){var t;return(t=class extends e{constructor(...e){super(...e),this.treeNodes=new Set}getTreeNode(){return[...this.treeNodes][this.treeNodes.size-1]||null}getTreeNodes(){return[...this.treeNodes]}getDomNode(e=!1){let t=this.treeNodes.size-1;const o=[...this.treeNodes];for(;t>=0;){const n=o[t];if(n.domNode&&(!e||'dom'===n.type))return n.domNode}return null}getDomNodes(e=!1){let t=[];for(const o of this.treeNodes)o.domNode&&('dom'===o.type?t.push(o.domNode):e||(t=t.concat(P.getTreeNodesForDomRootsUnder(o,!0).map((e=>e.domNode)))));return t}getRefBoundary(){const e=[...this.treeNodes][this.treeNodes.size-1];return e&&'boundary'===e.type&&e.boundary||null}getRefBoundaries(){const e=[];for(const t of this.treeNodes)'boundary'===t.type&&t.boundary&&e.push(t.boundary);return e}static didAttachOn(e,t){e.treeNodes.has(t)||(e.treeNodes.add(t),'dom'===t.type?e.domDidAttach&&t.domNode&&e.domDidAttach(t.domNode):'boundary'===t.type&&e.uiDidAttach&&t.boundary&&e.uiDidAttach(t.boundary))}static willDetachFrom(e,t){e.treeNodes.has(t)&&('dom'===t.type?e.domWillDetach&&t.domNode&&e.domWillDetach(t.domNode):'boundary'===t.type&&e.uiWillDetach&&t.boundary&&e.uiWillDetach(t.boundary)),e.treeNodes.delete(t)}}).UI_DOM_TYPE='Ref',t}class U extends(M(Object)){}const B=M;class O extends p{constructor(e,t,o=null){super(e,t,o)}static refresh(e,t,o){}static update(e,t){}static setProps(e,t,o,n){}static getAddedProps(){return{}}static getMixedProps(e){return{}}render(){return V}}O.UI_DOM_TYPE='Wired';const R=(e,t,o,...n)=>{var s;return(s=class e extends O{static getAddedProps(){return e.builder?e.builder(e.props,...n):e.props}static getMixedProps(t){return e.mixer?e.mixer(t,e.props,...n):Object.assign(Object.assign({},t),e.props)}static refresh(t=!0,o,n){e.setProps(this.getAddedProps(),t,o,n)}static update(t,o){for(const n of e.boundaries)n.update(!0,t,o)}static setProps(t,o=!0,n,s){this.props===t&&'force'!==o&&void 0===n&&void 0===s||(e.props=t,o&&e.update(n,s))}render(){return r.createDef(e.source,e.getMixedProps(this.props),V)}}).UI_DOM_TYPE='Wired',s.boundaries=new Set,s.source=e,s.builder='object'!=typeof t&&t||null,s.mixer=o||null,s.props=t?'object'==typeof t?t:t(null,...n):{},s.updateMode='always',s};class S{constructor(e){this.uiHost=e,this.uiRender=new f(e.settings),this.idCounter=0,this.updateTimer=null,this.renderTimer=null,this.updatesPending=new Set,this.postRenderInfos=[],this.postBoundaryCalls=[],this.listeners={update:[],render:[]}}createBoundaryId(){const e=this.idCounter;return this.idCounter++,'q-'+e.toString()}clearTimers(e=!1){e||this.runUpdates(null),null!==this.updateTimer&&(window.clearTimeout(this.updateTimer),this.updateTimer=null),null!==this.renderTimer&&(window.clearTimeout(this.renderTimer),this.renderTimer=null)}addListener(e,t){const o=this.listeners[e],n=o.indexOf(t);-1!==n?o[n]=t:o.push(t)}removeListener(e,t){const o=this.listeners[e],n=o.indexOf(t);-1!==n&&o.splice(n,1)}onContextPass(e){const t=this.uiHost.rootBoundary;t._outerContextsWere||(t._outerContextsWere=t.outerContexts),t.outerContexts=Object.assign({},e);const o=P.afterOuterContexts(t);for(const e of o)e._preUpdates&&this.absorbUpdates(e,{contextual:!0});this.runUpdates()}hasPending(e=!0,t=!0){return e&&null!==this.updateTimer||t&&null!==this.renderTimer||!1}cancelUpdates(e){this.updatesPending.delete(e)}absorbUpdates(e,t,o,n){null!==e.isMounted&&(void 0!==n&&(null===n||void 0===this._forcePostTimeout||null!==this._forcePostTimeout&&n<this._forcePostTimeout)&&(this._forcePostTimeout=n),P.preSetUpdates(e,t),e._renderState?e._renderState='re-updated':this.updatesPending.has(e)||(this.updatesPending.add(e),this._isUpdating||this.refreshWithTimeout('update',o)))}runUpdates(e){for(this.updateTimer=null,this._isUpdating=!0,e=void 0!==e?e:void 0!==this._forcePostTimeout?this._forcePostTimeout:this.uiHost.settings.renderTimeout,delete this._forcePostTimeout;this.updatesPending.size;){let e=[...this.updatesPending];this.updatesPending.clear(),e[1]&&P.sortBoundaries(e);let t=[],o=[];for(const n of e){const e=this.updateBoundary(n);e&&(t=t.concat(e[0]),o=o.concat(e[1]))}t[0]&&this.postRenderInfos.push(t),o[0]&&(this.uiHost.settings.uiDidImmediateCalls?S.callBoundaryChanges(o):this.postBoundaryCalls.push(o))}if(this.listeners.update[0])for(const e of this.listeners.update)e();this.refreshWithTimeout('render',e),delete this._isUpdating}updateBoundary(e,t=!1,o,n){let s=!!t,r='all'===t,i=[],d=[];const a=e.contextApi,c=!n;if(n||(n=[]),e.isMounted){let c=e._preUpdates;if(!c){if(!t)return null;c={}}const l={},u={};c.props&&(l.props=c.props,u.props=e._outerDef.props);const f=e.live;if(f&&a&&(c.state&&(l.state=c.state,u.state=f.state),c.contextual&&(l.remote=f.remote,a.rebuildRemote(),u.remote=f.remote)),c.force)s=!0,'all'===c.force&&(r=!0);else if(!s){let t=null;if(f)f.uiShouldUpdate&&(t=f.uiShouldUpdate(l,u));else if(e.mini)if(l.children&&l.children!==u.children)t=!0;else{const o=e.mini,n=o.constructor;o.uiShouldUpdate&&(t=o.uiShouldUpdate(l.props||null,u.props||null)),null==t&&n&&n.uiShouldUpdate&&(t=n.uiShouldUpdate(e,l.props||null,u.props||null))}(!0===t||null==t&&P.shouldUpdateBy(e,l,u))&&(s=!0)}const h='moved'===e._outerDef.action,p=h?s?'updated-n-moved':'moved':s?'updated':'';if(p&&d.push([e,p,l,u]),h){if(a){const t=a.getContexts();for(const o in t){const n=t[o];n&&n.services.onBoundaryMove(e,o)}}for(const t of P.getTreeNodesForDomRootsUnder(e.baseTreeNode,!0,!0)){if(o){if(-1!==o.indexOf(t))continue;o.push(t)}i.push({treeNode:t,move:!0})}}delete e._preUpdates;const m=e.live&&e.live.wired||null;if(m)for(const e of m){const t=e.props;if(e.refresh(!1),t!==e.props)for(const t of e.boundaries)t._preUpdates||(t._preUpdates={}),t._preUpdates.force||(t._preUpdates.force=!0),-1===n.indexOf(t)&&n.push(t)}if(f)f.uiBeforeUpdate&&f.uiBeforeUpdate(l,u,s);else if(e.mini){const t=e.mini,o=t.constructor;t.uiBeforeUpdate&&t.uiBeforeUpdate(l.props||null,u.props||null,s),o&&o.uiBeforeUpdate&&o.uiBeforeUpdate(e,l.props||null,u.props||null,s)}}else{if(null===e.isMounted)return null;d.push([e,'mounted']),s=!0}if(s){const[t,o]=P.runBoundaryUpdate(e,r);i=i.concat(t),d=d.concat(o)}if(c&&n[0]){const e=P.updateInterested(n,!0);i=i.concat(e[0]),d=d.concat(e[1])}return i[0]||d[0]?[i,d]:null}absorbChanges(e,t,o){e&&this.postRenderInfos.push(e),t&&(this.uiHost.settings.uiDidImmediateCalls?S.callBoundaryChanges(t):this.postBoundaryCalls.push(t)),this.refreshWithTimeout('render',o)}flushRender(){this.renderTimer=null;for(const e of this.postRenderInfos)e[0]&&this.uiRender.applyToDom(e);this.postRenderInfos=[];for(const e of this.postBoundaryCalls)e[0]&&S.callBoundaryChanges(e);if(this.postBoundaryCalls=[],this.listeners.render[0])for(const e of this.listeners.render)e()}refreshWithTimeout(e,t){'update'===e?this.updateTimer=P.refreshWithTimeout(this,this.runUpdates,this.updateTimer,this.uiHost.settings.updateTimeout,t):this.renderTimer=P.refreshWithTimeout(this,this.flushRender,this.renderTimer,this.uiHost.settings.renderTimeout,t)}static callBoundaryChanges(e){for(const t of e){const[e,o,n,s]=t,r=e.live||e.mini,i=e.mini&&e.mini.constructor;switch(o){case'updated':r&&r.uiDidUpdate&&(e.live?r.uiDidUpdate(n||{},s||{}):r.uiDidUpdate(n&&n.props||{},s&&s.props||{})),i&&i.uiDidUpdate&&i.uiDidUpdate(e,n&&n.props||{},s&&s.props||{});break;case'mounted':if(r&&r.uiDidMount&&r.uiDidMount(),i&&i.uiDidMount&&i.uiDidMount(e),e._outerDef.attachedRefs)for(const t of e._outerDef.attachedRefs)t.uiDidMount&&t.uiDidMount(e);break;case'updated-n-moved':case'moved':if(r&&r.uiDidMove&&r.uiDidMove(),i&&i.uiDidMove&&i.uiDidMove(e),'updated-n-moved'===o){r&&r.uiDidUpdate&&(e.live?r.uiDidUpdate(n||{},s||{}):r.uiDidUpdate(n&&n.props||{},s&&s.props||{})),i&&i.uiDidUpdate&&i.uiDidUpdate(e,n&&n.props||{},s&&s.props||{});break}}}}}function k(e){var t;return(t=class extends e{constructor(e,t,o){super(),this.settings=E.getDefaultSettings(o),this.services=new S(this),this.groundedTree={type:'root',parent:null,children:[],domNode:t||null,sourceBoundary:null},this.targetDef=r.createDefFromContent(e);const n=r.newAppliedDefBy({_uiDefType:'boundary',tag:()=>this._isDisabled?null:this.targetDef,props:{},childDefs:[]},null),s={type:'boundary',def:n,sourceBoundary:null,boundary:null,parent:this.groundedTree,children:[],domNode:null};this.groundedTree.children.push(s),this.rootBoundary=new w(this,n,s),this.rootBoundary.mini&&(this.rootBoundary.mini.updateMode='always'),s.boundary=this.rootBoundary,this.services.absorbUpdates(this.rootBoundary,{})}addListener(e,t){this.services.addListener(e,t)}removeListener(e,t){this.services.removeListener(e,t)}update(e,t,o){this.targetDef=r.createDefFromContent(e),this.rootBoundary.update(!0,t,o)}clear(e=!0,t,o){this.services.clearTimers(!0),this.targetDef=null,e&&this.rootBoundary.update(!0,t,o)}refresh(e=!1,t,o){const n=!this._isDisabled,s=!(this.settings.onlyRunInContainer&&!this.groundedTree.domNode&&!this.groundedTree.parent);if(s?delete this._isDisabled:this._isDisabled=!0,!e&&s&&n){if(s&&n){const e=this.rootBoundary?this.rootBoundary.getTreeNodesForDomRoots(!0).map((e=>({treeNode:e,move:!0}))):[];this.services.absorbChanges(e,null,o)}}else this.rootBoundary.update(!0,t,o)}refreshRender(e=!1,t){const o=!e||'read',n=[];let s,r=[...this.groundedTree.children],i=0;for(;s=r[i];)i+=1,s.domProps&&n.push({treeNode:s,refresh:o}),s.children[0]&&(r=s.children.concat(r.slice(i)),i=0);this.services.absorbChanges(n,null,t)}moveInto(e,t){if(this.groundedTree.domNode===e)return;this.groundedTree.domNode=e;const o=this.rootBoundary.getTreeNodesForDomRoots(!0).map((e=>({treeNode:e,move:!0})));(o[0]||void 0!==t)&&this.services.absorbChanges(o,null,t)}modifySettings(e){const t=this.settings.onlyRunInContainer,o=this.settings.welcomeContextsUpRoot;if(E.modifySettings(this.settings,e),void 0!==o&&o!==e.welcomeContextsUpRoot){const e=this.groundedTree.parent&&this.groundedTree.parent.sourceBoundary&&this.groundedTree.parent.sourceBoundary.uiHost,t=e&&this.settings.welcomeContextsUpRoot?e.rootBoundary.outerContexts:{};this.services.onContextPass(t)}void 0!==e.onlyRunInContainer&&e.onlyRunInContainer!==t&&this.refresh(!1,null,null)}getRootDomNode(){return this.rootBoundary&&this.rootBoundary.baseTreeNode.domNode}getRootDomNodes(e=!0){return this.rootBoundary?P.getTreeNodesForDomRootsUnder(this.rootBoundary.baseTreeNode,e,!1).map((e=>e.domNode)):[]}queryDomElement(e,t=!1){return P.queryDomElement(this.groundedTree,e,!0,t)}queryDomElements(e,t=0,o=!1){return P.queryDomElements(this.groundedTree,e,t,!0,o)}findDomNodes(e=0,t=!1,o){return P.findTreeNodesWithin(this.groundedTree,{dom:!0},e,!0,t,o).map((e=>e.domNode))}findBoundaries(e=0,t=!1,o){return P.findTreeNodesWithin(this.groundedTree,{boundary:!0},e,!0,t,o).map((e=>e.boundary))}findTreeNodes(e,t=0,o=!1,s){return P.findTreeNodesWithin(this.groundedTree,n.buildRecordable(e),t,!0,o,s)}static modifySettings(e,t){let o=!1;if(t.updateLiveModes)for(const n in t.updateLiveModes){const s=t.updateLiveModes[n];'string'==typeof s&&(e.updateLiveModes[n]=s,o=!0)}for(const n in t){const s=t[n],r=typeof s;null!==s&&'boolean'!==r&&'string'!==r&&'number'!==r||(e[n]=s,o=!0)}return o}static getDefaultSettings(e){const t={updateTimeout:0,renderTimeout:0,uiDidImmediateCalls:!1,callRefMoveEvenIfNoDomMove:!1,shouldUpdateWithNothing:!1,updateMiniMode:'shallow',updateLiveModes:{props:'shallow',state:'shallow',remote:'shallow',children:'changed'},preEqualCheckDomProps:!0,onlyRunInContainer:!1,welcomeContextsUpRoot:!0,wideKeysInArrays:!1,reuseSiblingTags:!0,noRenderValuesMode:!1,maxReRenders:1,renderTextTag:'',renderInnerHtmlTag:'span',renderTextContent:null,renderSvgNamespaceUri:'http://www.w3.org/2000/svg',renderDomPropsOnSwap:!0,duplicateDomNodeBehaviour:'deep',duplicateDomNodeHandler:null,devLogWarnings:!1,devLogRenderInfos:!1,devLogCleanUp:!1};if(e)for(const o in e)t[o]=e[o];return t}}).UI_DOM_TYPE='Host',t}class E extends(k(Object)){}const I=(e,t,o)=>new E(e,t,o),W=k;class H{constructor(e){this.uiContext=e,this.pendingTimer=null,this.pendingKeys=null,this.mainActions=null,this.postActions=null,this.dirtyOrder=0}sendAction(e,t,o){if(!e.type)return;let n=this.preHandleAction(e);const s=this.uiContext.settings;'cancel'!==n&&(t&&(n=t),'post'===n||s.postActions&&s.postActions.has(e.type)?(this.postActions||(this.postActions=[]),this.postActions.push(e)):'quick'===n||!0===s.quickActions||s.quickActions&&s.quickActions.has(e.type)?this.runAction(e):(this.mainActions||(this.mainActions=[]),this.mainActions.push(e))),this.applyRefresh(s.refreshTimeout,o)}askQuestion(e,t=0){this.preHandleAction(e,!0),this.runAction(e,null,!0,t)}applyRefresh(e,t){this.pendingTimer=P.refreshWithTimeout(this,this.refreshPending,this.pendingTimer,e,t)}refreshPending(){let e=this.mainActions,t=this.postActions;const o=this.pendingKeys;this.pendingTimer=null,this.pendingKeys=null,this.mainActions=null,this.postActions=null;const n=new Set,s=t?n:null;if(e)for(const t of e)this.runAction(t,s);if(o&&this.runData(o,s),t){for(const e of[...n])if(e.services.hasPending()){const t=[e],o=this.onHostRender.bind(this,t);t.push(o),e.services.addListener('render',o)}else n.delete(e);this.delayedActions||(this.delayedActions=[]),this.delayedActions.push([n,t]),n.size||this.onHostRender()}}onHostRender(e){let t=null;e&&(t=e[0],t.services.removeListener('render',e[1]));const o=this.delayedActions;if(!o)return;let n=-1;for(const[e,s]of[...o])if(n++,t&&e.delete(t),!e.size){o.splice(n--,1);for(const e of s)this.runAction(e)}o[0]||delete this.delayedActions}addRefreshKeys(e){if(!0===e)this.pendingKeys=!0;else if(e&&!0!==this.pendingKeys)if('string'==typeof e&&(e=[e]),this.pendingKeys)for(const t of e)-1===this.pendingKeys.indexOf(t)&&this.pendingKeys.push(t);else this.pendingKeys=[...e]}runData(t,o){const n=this.uiContext;let s=n.dataBoundaries;this.dirtyOrder&e.Data&&s.size>1&&(n.dataBoundaries=s=H.sortCollection(s)),this.dirtyOrder&=~e.Data;for(const[e,n]of s){o&&o.add(e.uiHost);for(const o of n){let n=!0===t;if(!n){const s=e.contextApi.contextNeeds.get(o);if(!0===s)n=!0;else if(s)for(const e of t)if(s.some((t=>t===e||t.startsWith(e+'.')))){n=!0;break}}if(n){e.uiHost.services.absorbUpdates(e,{contextual:!0});break}}}if(n.dataListeners.size)for(const[e,o]of n.dataListeners){let s=!1;if(!0===o||!0===t)s=!0;else{const e=[...o];for(const o of t)if(e.some((e=>e===o||e.startsWith(o+'.')))){s=!0;break}}s&&e(n.data,n)}}runAction(t,o,n,s){if(!t.type)return;const r=this.uiContext;let i=r.actionBoundaries;this.dirtyOrder&e.Actions&&(i.size>1&&(r.actionBoundaries=i=H.sortCollection(i)),this.dirtyOrder&=~e.Actions);const d=t;for(const[e,a]of i){const i=e.contextApi.actionNeeds,c=e.live;o&&o.add(e.uiHost);for(const e of a){const o=i.get(e);if(o&&(!0===o||o.has(t.type)))if(n){if(c.uponQuestion){if(d.value=c.uponQuestion(d,r,e),!d.values)return;const t=d.values.push(d.value);if(s&&t>=s)return}}else c.uponAction&&c.uponAction(t,r,e)}}for(const[e,o]of r.actionListeners)if(o&&(!0===o||o.has(t.type)))if(n){if(d.value=e(d,r),!d.values)return;const t=d.values.push(d.value);if(s&&t>=s)return}else e(t,r)}preHandleAction(e,t=!1){let o='';const n=this.uiContext;for(const[s,r]of n.actionHandlers)if(!0===r||r.has(e.type||''))if(t)s(e,n);else{const t=s(e,n);!t||o&&('cancel'===o||'post'===o&&'cancel'!==t)||(o=t)}return o}static flagActions(e,t,o,n=!0){if(null===o||!0===o)e[t]=o;else{const s='string'==typeof o?[o]:o,r=e[t];if(n&&r&&!0!==r)for(const e of s)r.add(e);else e[t]=new Set(s)}}onInterest(t,o,n){const s='data'===t,r=s?this.uiContext.dataBoundaries:this.uiContext.actionBoundaries,i=r.get(o);i?i.add(n):r.set(o,new Set([n])),this.dirtyOrder|=s?e.Data:e.Actions;const d=s?'onDataInterests':'onActionInterests';this.uiContext[d]&&this.uiContext[d](o,n,!0)}onDisInterest(e,t,o){const n='data'===e,s=n?'onDataInterests':'onActionInterests';this.uiContext[s]&&this.uiContext[s](t,o,!1);const r=n?this.uiContext.dataBoundaries:this.uiContext.actionBoundaries,i=r.get(t);i&&(i.delete(o),i.size||r.delete(t))}onBoundaryMove(t,o){const n=t.contextApi;this.dirtyOrder|=(n.actionNeeds.get(o)&&e.Actions||0)|(n.contextNeeds.get(o)&&e.Data||0)}static sortCollection(e){const t=[...e.keys()];return P.sortBoundaries(t),new Map(t.map((t=>[t,e.get(t)])))}}function L(e){var t;return(t=class extends e{constructor(e,t,...o){super(...o),this.inTree=new Map,this.dataBoundaries=new Map,this.actionBoundaries=new Map,this.dataListeners=new Map,this.actionListeners=new Map,this.actionHandlers=new Map,this.data=e,this.settings={postActions:null,quickActions:null,refreshTimeout:0},this.services=new H(this),t&&this.modifySettings(t)}modifySettings(e){void 0!==e.postActions&&H.flagActions(this.settings,'postActions',e.postActions,!1),void 0!==e.quickActions&&H.flagActions(this.settings,'quickActions',e.quickActions,!1),void 0!==e.refreshTimeout&&(this.settings.refreshTimeout=e.refreshTimeout)}flagPostActions(e,t=!0){H.flagActions(this.settings,'postActions',e,t)}flagQuickActions(e,t=!0){H.flagActions(this.settings,'quickActions',e,t)}addActionHandler(e,t=!0){this.actionHandlers.set(e,'object'!=typeof t||new Set('string'==typeof t?[t]:t))}removeActionHandler(e){this.actionHandlers.delete(e)}addActionListener(e,t=!0){this.actionListeners.set(e,'string'==typeof t?new Set([t]):'object'!=typeof t||new Set(t))}removeActionListener(e){this.actionListeners.delete(e)}addDataListener(e,t=!0){this.dataListeners.set(e,'string'==typeof t?new Set([t]):'object'!=typeof t||new Set(t))}removeDataListener(e){this.dataListeners.delete(e)}sendAction(e,t,o){this.services.sendAction(e,t,o)}sendActionWith(e,t,o,n){this.services.sendAction({type:e,payload:t},o,n)}askQuestion(e,t){return void 0===e.value&&(e.value=t),this.services.askQuestion(e,1),e.value}askQuestionWith(e,t,o){const n={type:e,payload:t,value:o};return this.services.askQuestion(n,1),n.value}askQuestionary(e,t=0){return e.values=[],this.services.askQuestion(e,t),e.values}askQuestionaryWith(e,t,o=0){const n={type:e,payload:t,values:[]};return this.services.askQuestion(n,o),n.values}setData(e,t=!1,o=!0,n){this.data=t&&this.data&&this.data.constructor===Object?Object.assign(Object.assign({},this.data),e):e,o&&this.refresh(!0,n)}setInData(e,t,o=!1,n=!0,s){const r=e.split('.'),i=r.pop();if(!i||!this.data)return;let d=this.data;for(const e of r)d=r[e];if(o){const e=d[i];e&&e.constructor===Object?d[i]=Object.assign(Object.assign({},e),t):o=!1}o||(d[i]=t),n&&this.refresh(e,s)}getData(){return this.data}getInData(e){const t=e.split('.');let o=this.data;for(const e of t)o=o[e];return o}refresh(e,t){e&&this.services.addRefreshKeys(e),this.services.applyRefresh(this.settings.refreshTimeout,t)}}).UI_DOM_TYPE='Context',t}class j extends(L(Object)){constructor(e,t){super(e,t)}}const F=(e,t)=>new j(e,t),q=L;class Y{constructor(e){}}Y.UI_DOM_TYPE='Contexts';function z(e){var t;return(t=class extends e{constructor(e,t,...o){super(...o),this.memory=t,this.onMount=e||null,this.onUnmount=null,this.depth=1}setDepth(e){this.depth=null==e?1:'string'==typeof e?o[e]:e}reset(e,t,o=!1){return this.use(t,o,e)}use(e,t=!1,o){const s=this.memory;return!t&&this.depth>-2&&n.areEqual(s,e,this.depth)||(this.memory=e,void 0!==o&&(this.onUnmount&&this.onUnmount(),this.onUnmount=null,this.onMount=o),this.onMount&&(this.onUnmount=this.onMount()||null)),!1}cancel(e=!1,t=!1){!e&&this.onUnmount&&this.onUnmount(),t&&(this.onMount=null,this.onUnmount=null)}}).UI_DOM_TYPE='Effect',t}class Q extends(z(Object)){}const K=z,G=(e,t,s=1)=>{let r,i=[];return s='string'==typeof s?o[s]:s,(...o)=>{const d=e(...o);return s>=-1&&n.areEqual(d,i,s)||(i=d,r=t(...i)),r}},V=r.newContentPassDef(),J=r.newContentPassDef({},!0),X={Host:E,HostMixin:W,Live:D,LiveMixin:x,Mini:p,MiniMixin:y,Ref:U,RefMixin:B,Context:j,ContextMixin:q,ContextAttach:t,Effect:Q,EffectMixin:K,createEffect:(e,t)=>new Q(e,t),createDataPicker:G,createDataSelector:(e,t,o=1)=>G(((...t)=>e.map((e=>e&&e(...t)))),t,o),Contexts:Y,Fragment:i,Portal:d,Element:a,Content:V,withContent:(...e)=>r.createDef(X.Fragment,{needsChildren:!0},...e),ContentCopy:J,copyContent:r.newContentCopyDef,create:I,createHost:I,createContext:F,createContexts:e=>{const t={};for(const o in e)t[o]=F(e[o]);return t},createRef:()=>new U,createSpread:l,spread:l,createLive:C,live:C,createLiveBy:v,liveBy:v,createMini:m,mini:m,createWired:R,wired:R,createDef:r.createDef,def:r.createDef,htmlDef:(e,t,o,s)=>{const r={_uiDefType:'content',tag:t||'',childDefs:[],domContent:e,domHtmlMode:!0};return t&&o&&(r.props=n.cleanHtmlProps(o)),null!=s&&(r.key=s),r},classNames:n.cleanHtmlClass,parseStyle:n.cleanHtmlStyle,areEqual:n.areEqual,range:n.range};window.UIDom=X}();
