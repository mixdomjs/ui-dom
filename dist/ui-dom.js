var e,t;Object.defineProperty(exports,'__esModule',{value:!0}),(e=>{e[e.Data=1]='Data',e[e.Actions=2]='Actions',e[e.Otherwise=4]='Otherwise',e[e.DoRefresh=8]='DoRefresh',e[e.NoRefresh=16]='NoRefresh',e[e.Contextual=3]='Contextual',e[e.All=7]='All'})(e||(e={})),(e=>{e[e.Cascading=1]='Cascading',e[e.Parent=2]='Parent',e[e.Overridden=4]='Overridden',e[e.All=7]='All'})(t||(t={}));const n={range(e,t,n=1){'number'!=typeof t&&([t,e]=[e,0]);const o=[];if(t<e)for(let s=e-1;s>=t;s-=n)o.push(s);else for(let s=e;s<t;s+=n)o.push(s);return o},buildRecordable(e){if(e.constructor===Object)return e;const t={};for(const n of e)t[n]=!0;return t},cleanHtmlProps(e,t){const o=t?Object.assign({},e):e;return o.className&&(o.class=o.class?o.class+' '+o.className:o.className),delete o.className,'string'==typeof o.style&&(o.style=n.cleanHtmlStyle(o.style)),o},cleanHtmlStyle(e){const t=e.replace(/\/\*(.|\s)*?\*\//g,' ').replace(/\s+/g,' ').trim();if(!t)return{};const n={},o=t.split(';').map((e=>e.split(':').map((e=>e&&e.trim()))));for(const[e,t]of o)e&&(n[e.replace(/\W+\w/g,(e=>e.slice(-1).toUpperCase()))]=t);return n},cleanHtmlClass(...e){const t={};for(const o of e)o&&n.collectNamesTo(o,t,' ');return Object.keys(t).join(' ')},collectNamesTo(e,t,n=''){switch(typeof e){case'string':if(n)for(const o of e.split(n))o&&(t[o]=!0);else t[e]=!0;break;case'object':if(e.constructor===Object)for(const n in e)n&&e[n]&&(t[n]=!0);else for(const o of e)if(o&&'string'==typeof o)if(n)for(const e of o.split(n))e&&(t[e]=!0);else t[o]=!0}},getClassNameDiffs(e,t){if((e=e||'')===(t=t||''))return null;const n=e.split(' '),o=t.split(' '),s={};let r=null;if(n)for(const e of n)!e||o&&-1!==o.indexOf(e)||(s[e]=r=!1);if(o)for(const e of o)!e||n&&-1!==n.indexOf(e)||(s[e]=r=!0);return null!==r?s:null},getDictionaryDiffs(e,t,n){const o={};for(const n in e){void 0!==e[n]&&void 0===t[n]&&(o[n]=void 0)}for(const n in t){const s=t[n];e[n]!==s&&(o[n]=s)}if(n)for(const e of n)delete o[e];for(const e in o)return o;return null},equalDomProps(e,t){if(e.style){if(!t.style)return!1;const n=e.style,o=t.style;for(const e in o)if(n[e]!==o[e])return!1;for(const e in n)if(void 0===o[e]&&void 0!==n[e])return!1}else if(t.style)return!1;for(const n in t)if(e[n]!==t[n]&&'style'!==n)return!1;for(const n in e)if(void 0===t[n]&&void 0!==e[n]&&'style'!==n)return!1;return!0},areEqual(e,t,o=-1){if(e===t)return!0;if(e&&o&&'object'==typeof e){if(!t||'object'!=typeof t)return!1;const s=e.constructor;if(s!==t.constructor)return!1;o--;let r=!1;switch(s){case Object:break;case Array:r=!0;break;case Set:r=!0,e=[...e],t=[...t];break;case Map:if(e.size!==t.size)return!1;for(const[s,r]of e){if(!t.has(s))return!1;if(!n.areEqual(t.get(s),r,o))return!1}return!0;default:const s=e.toString();'[object NodeList]'!==s&&'[object HTMLCollection]'!==s||(r=!0)}if(r){const s=e.length;if(s!==t.length)return!1;for(let r=0;r<s;r++)if(!n.areEqual(e[r],t[r],o))return!1}else{for(const s in t){if(!e.hasOwnProperty(s))return!1;if(!n.areEqual(e[s],t[s],o))return!1}for(const n in e)if(!t.hasOwnProperty(n))return!1}return!0}return!1}};var o=(e,t)=>{var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&'function'==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(n[o[s]]=e[o[s]])}return n};const s={getDefType(e){if('string'==typeof e)return'dom';const t=e.UI_DOM_TYPE;if(!t)return'function'==typeof e?'boundary':'';switch(t){case'Live':case'Mini':case'Wired':return'boundary';case'Spread':case'Fragment':case'Portal':case'Element':case'Contexts':case'Host':return t.toLowerCase();default:return''}},createDef(e='div',t=null,...r){const i=s.getDefType(e);if(!i)return null;const d=[];for(const e of r){const t=s.createDefFromContent(e);t&&d.push(t)}if('spread'===i)return e.unfold(t||{},d);if('fragment'===i&&!d[0])return null;const a='dom'===i&&e||'boundary'===i&&e||'element'===i&&'_'||('content'===i?'':null),c={_uiDefType:i,tag:a,childDefs:d},l=!!a;if('fragment'===i)t&&void 0!==t.needsChildren&&(c.props={needsChildren:t.needsChildren});else if(t){const{key:e,ref:s,contexts:r}=t,d=o(t,['key','ref','contexts']);if(null!=e&&(c.key=e),s){const e=[];if('Ref'===s.constructor.UI_DOM_TYPE)e.push(s);else for(const t of s)t&&'Ref'===t.constructor.UI_DOM_TYPE&&-1===e.indexOf(t)&&e.push(t);c.attachedRefs=e}r&&'boundary'===i&&(c.attachedContexts=Object.assign({},r)),l&&(c.props='string'==typeof a?n.cleanHtmlProps(d):d)}else l&&(c.props={});switch(c._uiDefType){case'portal':{const e=t||{};c.domPortal=e.container||null,!d[0]&&e&&null!=e.content&&(r=[e.content]);break}case'contexts':c.contexts=(t||{}).cascade||null;break;case'element':{const e=t||{};c.domElement=e.element||null,c.domCloneMode=null!=e.cloneMode?'boolean'==typeof e.cloneMode?e.cloneMode?'deep':'':e.cloneMode:null,delete c.props.element,delete c.props.cloneMode;break}}return c},createDefFromContent(e){if(e&&'object'==typeof e){if('string'==typeof e._uiDefType)return e;if(e instanceof Node)return{_uiDefType:'content',tag:'',childDefs:[],domContent:e};if('Host'===e.constructor.UI_DOM_TYPE)return{_uiDefType:'host',tag:null,host:e,key:e,childDefs:[]};if(Array.isArray(e)||e instanceof HTMLCollection||e instanceof NodeList){const t=[...e].map((e=>s.createDefFromContent(e))).filter((e=>e));return t.length?{_uiDefType:'fragment',tag:null,isArray:!0,childDefs:t}:null}e=String(e)}return null!=e?{_uiDefType:'content',tag:'',domContent:e,childDefs:[]}:null},newAppliedDefBy(e,t){const n={_uiDefType:e._uiDefType,tag:e.tag,key:e.key,childDefs:[],action:'mounted'};return e.isArray?n.isArray=!0:'pass'===n._uiDefType?n.contentPass=t||null:e.host&&(n.host=e.host),void 0!==e.keyScope&&(n.keyScope=e.keyScope),n},newContentPassDef(e,t){const n={_uiDefType:'pass',tag:null,childDefs:[],contentPassType:t?'copy':'pass'};return null!=e?n.key=e:t||(n.key=s.ContentKey),n},newContentCopyDef:e=>s.newContentPassDef(e,!0),ContentKey:{}};class r{constructor(e){}}r.UI_DOM_TYPE='Fragment';class i{constructor(e){}}i.UI_DOM_TYPE='Portal';class d{constructor(e){}}function a(e){var t;return(t=class extends e{constructor(e,t,...n){super(...n),this.memory=t,this.onMount=e||null,this.onUnmount=null,this.depth=1}reset(e,t,n=!1){return this.useWith(n?'always':this.depth,t,e)}use(e,t=!1,n){return this.useWith(t?'always':this.depth,e,n)}useWith(e,t,o){const s=this.memory;return this.memory=t,(e='string'==typeof e?c.DEPTH_BY_MODE[e]:e)>-2&&n.areEqual(s,t,e)||(void 0!==o&&(this.onUnmount&&this.onUnmount(),this.onUnmount=null,this.onMount=o),this.onMount&&(this.onUnmount=this.onMount()||null)),!1}cancel(e=!1,t=!1){!e&&this.onUnmount&&this.onUnmount(),t&&(this.onMount=null,this.onUnmount=null)}}).UI_DOM_TYPE='Effect',t.DEPTH_BY_MODE={always:-2,deep:-1,changed:0,shallow:1,double:2},t}d.UI_DOM_TYPE='Element';class c extends(a(Object)){}function l(e){var t;return(t=class extends e{constructor(...e){super(...e),this.attachedTo=new Set}getTreeNode(){return[...this.attachedTo][this.attachedTo.size-1]||null}getTreeNodes(){return[...this.attachedTo]}getDomNode(e=!1){let t=this.attachedTo.size-1;const n=[...this.attachedTo];for(;t>=0;){const o=n[t];if(o.domNode&&(!e||'dom'===o.type))return o.domNode}return null}getDomNodes(e=!1){const t=[];for(const n of this.attachedTo)!n.domNode||e&&'dom'!==n.type||t.push(n.domNode);return t}getRefBoundary(){const e=[...this.attachedTo][this.attachedTo.size-1];return e&&'boundary'===e.type&&e.boundary||null}getRefBoundaries(){const e=[];for(const t of this.attachedTo)'boundary'===t.type&&t.boundary&&e.push(t.boundary);return e}static didAttachOn(e,t){e.attachedTo.has(t)||(e.attachedTo.add(t),'dom'===t.type?e.domDidAttach&&t.domNode&&e.domDidAttach(t.domNode):'boundary'===t.type&&e.uiDidAttach&&t.boundary&&e.uiDidAttach(t.boundary))}static willDetachFrom(e,t){e.attachedTo.has(t)&&('dom'===t.type?e.domWillDetach&&t.domNode&&e.domWillDetach(t.domNode):'boundary'===t.type&&e.uiWillDetach&&t.boundary&&e.uiWillDetach(t.boundary)),e.attachedTo.delete(t)}}).UI_DOM_TYPE='Ref',t}class u extends(l(Object)){}var h=(e,t)=>{var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&'function'==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(n[o[s]]=e[o[s]])}return n};class f{constructor(e){}static unfold(e,t){return null}static unfoldWith(e,t,n){let o,s=[[e,null]],r=!1,i=0;for(;o=s[i];){i++;let d=o[0];const a=o[1];if('fragment'===d._uiDefType&&d.props&&d.props.needsChildren){const n=h(d,['props']);t.length||(n.childDefs=[]),a?a.childDefs[a.childDefs.indexOf(d)]=n:e=n,d=n}if(d.keyScope=n,'pass'===d._uiDefType){const n={_uiDefType:'fragment',tag:null,childDefs:[...t]};if(null!==d.key&&(n.key=d.key),a?a.childDefs[a.childDefs.indexOf(d)]=n:e=n,r||'copy'===d.contentPassType){const e=null!=d.key?d.key:null;let t,o=[n],s=0;for(;t=o[s];)if(s++,t.childDefs[0]){let n=0;for(const o of t.childDefs){const s='pass'===o._uiDefType?o:Object.assign(Object.assign({},o),{childDefs:[...o.childDefs],keyScope:e});t.childDefs[n]=s,n++}o=t.childDefs.concat(o.slice(s)),s=0}}else r=!0}else if(d.childDefs[0]){const e=[];for(const t of d.childDefs)e.push([t,d]);s=e.concat(s.slice(i)),i=0}}return e}}f.UI_DOM_TYPE='Spread';const p=e=>{var t;return(t=class e extends f{static unfold(t,n){let o=s.createDefFromContent(e.render(t));if(o){const t=null==o.key?e:o.key;o=e.unfoldWith(o,n,t)}return o}}).render=e,t};function m(e){var t;return(t=class extends e{constructor(e,t=null,...n){super(...n),this.props=e,this.updateMode=t}setUpdateMode(e){this.updateMode=e}render(e){return q.Content}isMounted(){return!1}getChildren(e=!1,t=!0){return[]}needsChildren(e){}}).UI_DOM_TYPE='Mini',t}class y extends(m(Object)){}const g=e=>function(t){return e(this,t)};class D extends y{constructor(e,t=null){super(e,t)}static refresh(e,t,n){}static updateWired(e,t){}static setProps(e,t,n,o){}static getWiredProps(){return{}}static getMixedProps(e){return{}}render(){return L}}D.UI_DOM_TYPE='Wired';const C=(e,t,n,...o)=>{var r;return(r=class e extends D{static getWiredProps(){return e.builder?e.builder(e.props,...o):e.props}static getMixedProps(t){return e.mixer?e.mixer(t,e.props,...o):Object.assign(Object.assign({},t),e.props)}static refresh(t=!0,n,o){e.setProps(this.getWiredProps(),t,n,o)}static updateWired(t,n){for(const o of e.instanced)o.update(!0,t,n)}static setProps(t,n=!0,o,s){this.props===t&&'force'!==n&&void 0===o&&void 0===s||(e.props=t,n&&e.updateWired(o,s))}render(){return s.createDef(e.source,e.getMixedProps(this.props),L)}}).instanced=new Set,r.source=e,r.builder='object'!=typeof t&&t||null,r.mixer=n||null,r.props=t?'object'==typeof t?t:t(null,...o):{},r.updateMode='always',r};var x=(e,t)=>{var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&'function'==typeof Object.getOwnPropertySymbols){var s=0;for(o=Object.getOwnPropertySymbols(e);s<o.length;s++)t.indexOf(o[s])<0&&Object.prototype.propertyIsEnumerable.call(e,o[s])&&(n[o[s]]=e[o[s]])}return n};class v{constructor(e){this.settings=e,this.externalElements=new Set}getApprovedNode(e,t){let n=e;const o=null!=t.def.domCloneMode?t.def.domCloneMode:this.settings.duplicateDomNodeBehaviour;return('always'===o||this.externalElements.has(e))&&(n=this.settings.duplicateDomNodeHandler?this.settings.duplicateDomNodeHandler(e,t):o?e.cloneNode('deep'===o||'always'===o):null),n&&this.externalElements.add(n),n}createDomNodeBy(e){const t=e.def.tag;if('string'!=typeof t)return null;if('_'===t)return e.def.domElement&&this.getApprovedNode(e.def.domElement,e)||null;const n=e.def.domContent;if(n instanceof Node)return this.getApprovedNode(n,e);if(e.def.domHtmlMode&&null!=n&&''!==n)return v.domNodeFrom(n.toString(),t||this.settings.renderInnerHtmlTag,!0);if(t)return'svg'===t||e.parent&&e.parent.domNode&&void 0!==e.parent.domNode.ownerSVGElement?document.createElementNS(this.settings.renderSvgNamespaceUri||'http://www.w3.org/2000/svg',t):document.createElement(t);let o=null,s='',r='';if(null!=n){r=(this.settings.renderTextContent?this.settings.renderTextContent(n):n).toString();const e=this.settings.renderTextTag;if(e)if('string'==typeof e)s=e;else if('function'==typeof e){const t=e(n);t instanceof Node&&(o=t)}}return o||(o=s?document.createElement(s):document.createTextNode(r)),s&&r&&(o.textContent=r),o}applyToDom(e){const t=[];let n=null;const o=[];this.settings.devLogRenderInfos&&console.log('__UIRender.applyToDom: Dev-log: Received rendering infos: ',e);for(const s of e){const e=s.treeNode;if(s.remove){if('dom'===e.type&&e.domNode){const o=e.domNode,s=o.parentNode,r=e.def.attachedRefs;let i=!1;if(r)for(const t of r)t&&t.domWillUnmount&&t.domWillUnmount(o)&&(i=!0),u.willDetachFrom(t,e);i?n?n.push(o):n=[o]:!s||-1!==t.indexOf(s)||n&&n.some((e=>e.contains(o)))||s.removeChild(o);const d='element'===e.def._uiDefType;(d||'content'===e.def._uiDefType)&&this.externalElements.delete(o),d||t.push(o),e.domNode=null,v.updateDomChainBy(e,null)}continue}let r=!1,i=!1;if(s.refresh&&e.domNode&&e.domProps&&(e.domProps='read'===s.refresh?v.readFromDom(e.domNode):{},r=!0),s.create)switch(e.type){case'dom':const t=this.createDomNodeBy(e);t&&(e.domNode=t,i=!0);break;case'portal':e.domNode=e.def.domPortal||null}if(i||s.move)if('host'===e.type){const t=e.def.host||null;t&&t.refresh(!1,null,null),e.domNode=e.parent&&t&&t.getRootDomNode()||null,v.updateDomChainBy(e,e.domNode)}else{const t=e.domNode;if(t){const e=t.parentNode;o.push([s,e]),e&&e.removeChild(t)}v.updateDomChainBy(e,t)}if(s.swap){const t=e.domNode;let n=('portal'===e.type?e.def.domPortal:e.def.domElement)||null;if(t!==n){if('dom'===e.type){const o=e,s=t&&t.parentNode;if(n&&(n=this.getApprovedNode(n,o),n)){let[o,r]=s?[s,t]:v.findInsertionNodes(e);o&&o.insertBefore(n,r)}if(t){if(this.externalElements.delete(t),o.domProps&&t instanceof Element)for(const e in o.domProps){const n=v.LISTENER_PROPS[e];n&&t.removeEventListener(n,o.domProps[e])}s&&s.removeChild(t)}o.domProps&&(o.domProps=n&&'read'===this.settings.renderDomPropsOnSwap?v.readFromDom(n):{},r=!0)}for(const t of e.children){const e=t.domNode;e&&(e.parentNode&&e.parentNode.removeChild(e),n&&n.appendChild(e))}e.domNode=n,v.updateDomChainBy(e,n)}}if(s.content&&'dom'===e.type&&e.domNode){const t=e.def.domContent,n=e.domNode;let o=n;if('content'===e.def._uiDefType){if(e.def.domHtmlMode&&null!=t&&''!==t)o=v.domNodeFrom(t.toString(),e.def.tag||this.settings.renderInnerHtmlTag,!0),e.domProps&&(r=!0,e.domProps={});else{const e=null==t?'':(this.settings.renderTextContent?this.settings.renderTextContent(t):t).toString();3!==n.nodeType?o=document.createTextNode(e):n.textContent=e}}else if(t instanceof Node){const e=t.parentNode;e&&e.removeChild(t)}else n.textContent='';if(n!==o){const t=n.parentNode;t&&(e.domNode=o,t.insertBefore(o,n),t.removeChild(n)),v.updateDomChainBy(e,e.domNode)}const s=e.def.attachedRefs;if(s)for(const n of s)n&&n.domDidContent&&n.domDidContent(e.domNode,null!=t?t:null)}if((i||r||s.update)&&'dom'===e.type&&e.domNode&&e.domNode instanceof Element){const t=v.domApplyProps(e,this.settings.devLogWarnings),{appliedProps:n}=t,o=x(t,['appliedProps']);if(e.domProps=n,s.update){const t=e.def.attachedRefs;if(t)for(const n of t)n&&n.domDidUpdate&&n.domDidUpdate(e.domNode,o)}}s.emptyMove&&v.updateDomChainBy(e,null,!0)}let s=o.length-1;if(s>=0){let e,t=!1;for(;e=o[s--];){const[{move:n,treeNode:o}]=e,s=o.domNode,[r,i]=s?v.findInsertionNodes(o):[null,null];if(r&&s){const d=s.nextSibling,a=r!==s.parentNode||i!==d;a&&r&&r.insertBefore(s,i);const c=o.def&&o.def.attachedRefs;c&&(a||n&&this.settings.callRefMoveEvenIfNoDomMove)&&(t=!0,e[2]=d,e[3]=c)}else!this.settings.devLogWarnings||s||r||console.warn('__UIRender.applyToDom: Error: Cannot move element: ',s,' into parent: ',r,' for treeNode: ',o)}if(t)for(s=0;e=o[s];s++){if(!e[3])continue;const[t,n,o,s]=e,r=t.treeNode.domNode;for(const e of s)t.move?e.domDidMove&&e.domDidMove(r,n,o):(u.didAttachOn(e,t.treeNode),e&&e.domDidMount&&e.domDidMount(r))}}}static findInsertionNodes(e){let t=null,n=e.parent;for(;n;){if(!(v.PASSING_TYPES[n.type]||'root'===n.type&&n.parent)){t=n.domNode;break}n=n.parent}if(!t)return[null,null];let o=null,s=e;for(;s&&(n=s.parent,n);){let e,r=n.children.indexOf(s)+1;for(;e=n.children[r];){if(e.domNode&&'portal'!==e.type){o=e.domNode;break}r++}if(o||n.domNode===t)break;s=n}return[t,o]}static updateDomChainBy(e,t,n=!1){let o=e,s=n?e:e.parent,r=t;for(;s&&v.PASSING_TYPES[s.type]&&(s.children[0]===o||s===o);){if(!r){let e,t=s.children.indexOf(o)+1;for(;e=s.children[t];){if(e.domNode&&'portal'!==e.type){r=e.domNode;break}t++}}s.domNode=r,o=s,s=s.parent}}static readFromDom(e){const t={};if(!(e instanceof Element))return t;for(const n of e.getAttributeNames())t[n]=e.getAttribute(n);return e.style.cssText&&(t.style=n.cleanHtmlStyle(e.style.cssText)),t}static domNodeFrom(e,t='div',n=!1){const o=t instanceof Element?t:document.createElement(t);return o.innerHTML=e,n||o.children[1]?o:o.children[0]}static domApplyProps(e,t=!1){const o=e.domNode,s=e.def.props||{},r=e.domProps||{},i={},d={appliedProps:i};if(!o)return d;const a=n.getDictionaryDiffs(r,s,['style','class']);if(a){d.attrDiffs=a;for(const n in a){const s=a[n],d=void 0!==s,c=v.LISTENER_PROPS[n];if(v.IGNORE_PROPS[n])t&&console.warn('__UIRender.domApplyProps: Warning: Is using an ignored dom prop: ',n,' for treeNode: ',e);else{if(c){const e=r[n];e&&o.removeEventListener(c,e),d&&o.addEventListener(c,s)}else d?o.setAttribute(n,s):o.removeAttribute(n);d?i[n]=s:delete i[n]}}}const c=r.style||s.style?n.getDictionaryDiffs(r.style||{},s.style||{}):null;if(c){d.styleDiffs=c,i.style||(i.style={});for(const e in c){const t=c[e];null==t?(o.style[e]='',delete i.style[e]):(o.style[e]=t,i.style[e]=t)}}const l=r.class!==(s.class||void 0)?n.getClassNameDiffs(r.class,s.class):null;if(l){d.classDiffs=l;for(const e in l)l[e]?o.classList.add(e):o.classList.remove(e);s.class?i.class=s.class:delete i.class}return d}}v.IGNORE_PROPS={innerHTML:!0,textContent:!0},v.PASSING_TYPES={boundary:!0,pass:!0,contexts:!0,host:!0},v.LISTENER_PROPS=['Abort','AnimationCancel','AnimationEnd','AnimationIteration','AnimationStart','AuxClick','Blur','CanPlay','CanPlayThrough','Change','Click','Close','ContextMenu','CueChange','DblClick','Drag','DragEnd','DragEnter','DragLeave','DragOver','DragStart','Drop','DurationChange','Emptied','Ended','Error','Focus','GotPointerCapture','Input','Invalid','KeyDown','KeyPress','KeyUp','Load','LoadedData','LoadedMetaData','LoadStart','LostPointerCapture','MouseDown','MouseEnter','MouseLeave','MouseMove','MouseOut','MouseOver','MouseUp','Pause','Play','Playing','PointerCancel','PointerDown','PointerEnter','PointerLeave','PointerMove','PointerOut','PointerOver','PointerUp','Progress','RateChange','Reset','Resize','Scroll','SecurityPolicyViolation','Seeked','Seeking','Select','Stalled','Submit','Suspend','TimeUpdate','Toggle','TouchCancel','TouchEnd','TouchMove','TouchStart','TransitionCancel','TransitionEnd','TransitionRun','TransitionStart','VolumeChange','Waiting','Wheel'].reduce(((e,t)=>(e['on'+t]=t.toLowerCase(),e)),{});class b{constructor(e){this.boundary=e,this.actionNeeds=new Map,this.contextNeeds=new Map}needsAction(e,t,n=!0){const o=this.actionNeeds.get(e);if(!0===o)return;const s=this.getContext(e);n?(o?o.add(t):this.actionNeeds.set(e,new Set([t])),s&&s.services.onInterest('actions',this.boundary,e)):o&&o.has(t)&&(o.delete(t),o.size||(this.actionNeeds.delete(e),s&&s.services.onDisInterest('actions',this.boundary,e)))}needsActions(e,t=[],n=!1){const o=this.actionNeeds.get(e);if('boolean'==typeof t)t?this.actionNeeds.set(e,!0):this.actionNeeds.delete(e);else if(n){if(t.length)if(o){if(!0!==o)for(const e of t)o.add(e)}else this.actionNeeds.set(e,new Set(t))}else t.length?this.actionNeeds.set(e,new Set(t)):this.actionNeeds.delete(e);if(!t!=!o){const n=this.getContext(e);n&&(t?n.services.onInterest('actions',this.boundary,e):n.services.onDisInterest('actions',this.boundary,e))}}needsContext(e,t=!0,n=!0){const o=!!this.contextNeeds.get(e);if(!1===t?this.contextNeeds.delete(e):this.contextNeeds.set(e,'string'==typeof t?[t]:t),o!==!t)return;const s=this.getContext(e)||null;s&&(t?s.services.onInterest('data',this.boundary,e):s.services.onDisInterest('data',this.boundary,e)),n&&this.updateContext()}needsContexts(e,t=!0){const o=[...this.contextNeeds.keys()];let s=!1;for(const t of o){if(e[t])continue;const n=this.getContext(t);s=!0,n&&n.services.onDisInterest('data',this.boundary,t)}const r=new Map;for(const t in e){const i=e[t];if(r.set(t,'string'==typeof i?[i]:i),-1!==o.indexOf(t)){const e=this.contextNeeds.get(t);if(e===i||n.areEqual(e,i))continue}const d=this.getContext(t);s=!0,d&&d.services.onInterest('data',this.boundary,t)}s&&(this.contextNeeds=r,t&&this.updateContext())}overrideContext(e,n,o=!0){const s=this.getContext(e),r=void 0!==n?n:this.getContext(e,t.Parent|t.Cascading);let i=this.overriddenContexts;void 0===n?i&&(delete i[e],Object.keys(i).length||delete this.overriddenContexts):(i||(i=this.overriddenContexts={}),i[e]=n);const d=s!==r?w.helpUpdateContext(this.boundary,e,r||null,s||null):0;return o&&w.shouldUpdateContextually(d)&&this.updateContext(),d}overrideContexts(e,t=!0){let n=0;for(const t in e)n|=this.overrideContext(t,e[t],!1);return t&&w.shouldUpdateContextually(n)&&this.updateContext(),n}getContext(e,n=t.All){if(n&t.Overridden){const t=this.overriddenContexts;if(t&&void 0!==t[e])return t[e]}if(n&t.Parent){const t=this.boundary._outerDef.attachedContexts;if(t&&void 0!==t[e])return t[e]}if(n&t.Cascading)return this.boundary.outerContexts[e]}getContexts(e,o=t.All){const s=e?n.buildRecordable(e):null,r={};if(o&t.Cascading)for(const e in this.boundary.outerContexts)s&&!s[e]||(r[e]=this.boundary.outerContexts[e]);if(o&t.Parent){const e=this.boundary._outerDef.attachedContexts;if(e)for(const t in e)s&&!s[t]||(r[t]=e[t])}if(o&t.Overridden){const e=this.overriddenContexts;if(e)for(const t in e)s&&!s[t]||(r[t]=e[t])}return r}updateContext(e,t){this.boundary.isMounted?this.boundary.uiHost.services.addToUpdates(this.boundary,{contextual:!0},e,t):this.contextNeeds.size&&this.rebuildContext()}rebuildContext(){const e={},t={},n=this.boundary.contextApi.overriddenContexts,o=this.boundary._outerDef.attachedContexts;for(const s of this.contextNeeds.keys()){let r=n?n[s]:void 0;o&&void 0===r&&(r=o[s]),void 0===r&&(r=this.boundary.outerContexts[s]),t[s]=r||null,e[s]=r?r.data:null}const s=this.boundary.live;s.buildContext&&(s.context=s.buildContext(e,t))}}class T{constructor(e){e&&(this.readChildren=e)}readChildren(e){return null}getChildren(e=!1,t=!0){return e||'boolean'==typeof this.childrenNeeds||(this.childrenNeeds='temp'),this.readChildren(t)}needsChildren(e){null==e?delete this.childrenNeeds:this.childrenNeeds=e}}class N{constructor(e,t){this.thruBoundary=e,this.sourceBoundary=t||null,this.envelope=null,this.truePassDef=null,this.groundedDefsMap=new Map,this.pendingDefs=new Set}contentGrounded(e,t,n,o){if(this.groundedDefsMap.get(e)){if('moved'===e.action&&n.boundary){return[n.boundary.getTreeNodesForDomRoots(!0).map((e=>({treeNode:e,move:!0}))),[]]}return[[],[]]}return this.groundedDefsMap.set(e,[t,n,o]),this.applyContentDefs([e])}contentUngrounded(e){const t=this.groundedDefsMap.get(e);if(!t)return[[],[]];this.truePassDef===e&&(this.truePassDef=null),this.groundedDefsMap.delete(e),this.pendingDefs.delete(e);const n=t[1].boundary;return n?w.destroyBoundary(n):[[],[]]}preRefresh(e){if(!this.envelope&&!e)return[];const t=this.envelope?this.envelope.targetDef.childDefs.slice():[];this.envelope=e,this.pendingDefs=new Set(this.groundedDefsMap.keys());const n=[];for(const[e]of this.groundedDefsMap.values()){let o=e;for(;o;){const e=o.contentApi;if(e&&(e.childrenNeeds&&(n.push(o),o._preUpdates?o._preUpdates.children||(o._preUpdates.children=t):o._preUpdates={children:t}),!o.contentClosure.envelope))break;if(o=o.sourceBoundary,o===this.sourceBoundary)break}}return n[0]&&n.reverse(),n}applyRefresh(e=!1){let t=[],n=[];if(this.pendingDefs.size&&([t,n]=this.applyContentDefs(this.pendingDefs,e)),!this.truePassDef&&this.envelope){const e=this.thruBoundary.uiHost.settings.devLogCleanUp;for(const o of this.envelope.appliedDef.childDefs){const s=o.treeNode;if(s){if(e&&console.log('__UIContentClosure.applyRefresh dev-log - clean up treeNode (no true pass): ',s),'dom'===s.type)t.push({treeNode:s,remove:!0});else if(s.boundary){const[e,o]=w.destroyBoundary(s.boundary);t=t.concat(e),n=n.concat(o)}s.parent=null,s.sourceBoundary=null,delete o.treeNode}}}return[t,n]}applyContentDefs(e,t=!1){e||(e=this.groundedDefsMap.keys());let n=[],o=[];for(const s of e){this.pendingDefs.delete(s);const e=this.groundedDefsMap.get(s);if(void 0===e)continue;let[r,i,d]=e,a=i.boundary;if(this.envelope&&this.sourceBoundary){let e=!0;a?(e=this.truePassDef===s,a.updateEnvelope(this.envelope.targetDef,e?this.envelope.appliedDef:null)):(a=new A(s,this.envelope.targetDef,i,this.sourceBoundary),e=null==d&&(!this.truePassDef||this.truePassDef===s),e&&(a._innerDef.childDefs=this.envelope.appliedDef.childDefs,this.truePassDef=s),a.parentBoundary=r,i.boundary=a);const[c,l]=e?w.runContentPassUpdate(a,t):w.runBoundaryUpdate(a,t);n=n.concat(c),o=o.concat(l)}else a&&(n=n.concat(w.destroyBoundary(a,!1)[0]),i.boundary=null)}return[n,o]}}class _{constructor(e,t,n){this.uiHost=e,this.baseTreeNode=n,this._outerDef=t,this._innerDef=null,this.isMounted=!1,this.sourceBoundary=null,this.parentBoundary=null,this.innerBoundaries=[],this.outerContexts={}}getRootTreeNodes(){return[...this.baseTreeNode.children]}getTreeNodesForDomRoots(e=!1,t=!1){return w.getTreeNodesForDomRootsUnder(this.baseTreeNode,e,t)}getRootDomNode(){return this.baseTreeNode.domNode}getRootDomNodes(e=!1){return w.getTreeNodesForDomRootsUnder(this.baseTreeNode,e,!1).map((e=>e.domNode))}getAllDomNodes(e=!0,t=!1){if(!this._innerDef)return[];const n=[];let o,s=[this._innerDef],r=0;for(;o=s[r];){if(r++,o.treeNode){const n=o.treeNode.type;if('host'===n)continue;if(!e&&'boundary'===n)continue;if(!t&&'pass'===n)continue}o.childDefs[0]&&(s=o.childDefs.concat(s.slice(r)),r=0),o.treeNode&&'dom'===o.treeNode.type&&o.treeNode.domNode&&n.push(o.treeNode.domNode)}return n}}class A extends _{constructor(e,t,n,o){super(o.uiHost,e,n),this.sourceBoundary=o,this.targetDef=t,this._innerDef=s.newAppliedDefBy(t,o.contentClosure)}updateEnvelope(e,t){this.targetDef=e,t&&(this._innerDef.childDefs=t.childDefs)}}class P extends _{constructor(e,t,n,o){super(e,t,n),this._isVirgin=!0,this.uiId=e.services.createBoundaryId(),this.sourceBoundary=o||null,this.contentClosure=new N(this,o),this.reattach(!1)}reattach(e=!0){e&&(delete this.contextApi,delete this.contentApi,delete this.live,delete this.mini),this.type='';let t=this._outerDef.tag;if('function'==typeof t){switch(t.UI_DOM_TYPE){case void 0:if(t.length<2)this.type='mini',this.mini=new y(this._outerDef.props||{}),this.mini.render=this._outerDef.tag;else{this.type='live';const e=class extends(M(Object)){};this.live=new e(this._outerDef.props||{}),this.live.render=this._outerDef.tag}break;case'Live':this.type='class-live',this.live=new t(this._outerDef.props);break;case'Mini':this.type='class-mini',this.mini=new t(this._outerDef.props),this.mini.render=this._outerDef.tag;break;case'Wired':this.type='class-wired';const e=t;this.mini=new e(this._outerDef.props),e.instanced.add(this),e.wiredDidMount&&e.wiredDidMount(this.mini,this)}const e=this.live||this.mini?(e=!0)=>{var t;const n=(null===(t=this.contentClosure.envelope)||void 0===t?void 0:t.targetDef.childDefs)||null;return n&&(e?n.slice():n)}:null;this.live&&(this.contentApi=new T(e),this.contextApi=new b(this),this.live.boundary=this),this.mini&&(this.contentApi=new T(e),this.mini.isMounted=()=>!0===this.isMounted,this.mini.getChildren=this.contentApi.getChildren.bind(this.contentApi),this.mini.needsChildren=this.contentApi.needsChildren.bind(this.contentApi))}}update(e,t,n){this.uiHost.services.addToUpdates(this,{force:this.isMounted?e||!1:'all'},t,n)}updateBy(e,t,n,o){this.uiHost.services.addToUpdates(this,Object.assign(Object.assign({},e),{force:this.isMounted?t||!1:'all'}),n,o)}render(e=0){let t;e||(this._renderingState='active'),this.contentApi&&'temp'===this.contentApi.childrenNeeds&&delete this.contentApi.childrenNeeds;const n=this._outerDef.props||{};if(this.mini?t=this.mini.render(n):this.live&&(t='live'===this.type?this.live.render(n,this.live):this.live.render()),'function'==typeof t)return this.mini?this.mini.render=t:this.live&&(this.live.render=t),this.render(e);if(this._isVirgin){delete this._isVirgin;const e=this.live;if(e&&e.onContextChange&&e.render.length>1){const t=e.getContexts();for(const n in t)e.onContextChange(n,t[n],null)}}if('re-updated'===this._renderingState){const t=this.uiHost.settings.maxReRenders;if(t<0||e<t)return e++,this._renderingState='active',this.render(e);this.uiHost.settings.devLogWarnings&&console.warn('__UISourceBoundary.render: Warning: The boundary tried to render for over '+(e+1).toString()+' times.','class-live'===this.type&&this.live&&this.live.constructor||('class-wired'===this.type||'class-mini'===this.type)&&this.mini&&this.mini.constructor||this._outerDef.tag,this)}return delete this._renderingState,t}}const w={SEARCH_TAG_BY_TYPE:{fragment:1,portal:2,pass:3,contexts:4,host:5},runContentPassUpdate(e,t=!1){const[n,o,s]=w.assignTreeNodesForPass(e);let[r,i]=w.applyDefPairs(e,n,t);if(o[0]){const t=new Set;for(const e of o)e.sourceBoundary||(e.def&&t.add(e.def),e.parent=null);if(t.size){r=w.cleanUpBoundaryDefs(t,e.uiHost.settings.devLogCleanUp).concat(r)}}return s[0]&&(r=s.map((e=>({treeNode:e,emptyMove:!0}))).concat(r)),e.isMounted=!0,[r,i]},runBoundaryUpdate(e,t=!1){let n=null,o=e._innerDef;e.uiId?(n=s.createDefFromContent(e.render()),n&&!o&&(o=s.newAppliedDefBy(n,e.contentClosure))):n=e.targetDef;const[r,i]=o?w.buildDefMaps(o):[new Map,new Set];let d,a;const c=[];if(n){const s=[],l=w.pairDefs(e,n,o,r,i,s,c);e._innerDef=l[0][1];const u=w.applyDefPairs(e,l,t);if(d=u[0],a=u[1],s[0])for(const e of s){const t=e.treeNode;t&&null===t.sourceBoundary&&i.add(e)}}else d=[{treeNode:e.baseTreeNode,emptyMove:!0}],a=[],e.innerBoundaries=[],e.baseTreeNode.children=[],e._innerDef=null;if(i.size){d=w.cleanUpBoundaryDefs(i,e.uiHost.settings.devLogCleanUp).concat(d)}return c[0]&&(d=c.map((e=>({treeNode:e,emptyMove:!0}))).concat(d)),e.isMounted||(e.isMounted=!0),delete e._outerContextsWere,[d,a]},applyDefPairs(t,o,s=!1){const r=t.uiId?t:t.sourceBoundary,i=[],d=t.uiHost.settings.preEqualCheckDomProps;t.innerBoundaries=[];let a=[],c=[];for(const l of o){const[o,h,f,p]=l,m='mounted'===h.action;if(!m&&'moved'===h.action)switch(h._uiDefType){case'contexts':case'fragment':for(const e of w.getTreeNodesForDomRootsUnder(f,!0,!0))-1===i.indexOf(e)&&(i.push(e),a.push({treeNode:e,move:!0}));break;case'host':h.host&&h.host.groundedTree.parent===f&&a.push({treeNode:f,move:!0})}if('fragment'===h._uiDefType)continue;if('pass'===f.type){if('pass'!==h._uiDefType)continue;if(h.contentPass){const[e,n]=h.contentPass.contentGrounded(h,t,f,h.key!==L.key?h.key:null);a=a.concat(e),c=c.concat(n)}f.boundary&&t.innerBoundaries.push(f.boundary);continue}const y=h.props;let g=!1;switch(o.props&&h.props!==o.props&&(f.boundary&&w.preSetUpdates(f.boundary,{props:o.props}),h.props=o.props||{}),h._uiDefType){case'content':const e=o.domHtmlMode;g=h.domContent!==o.domContent||e!==o.domHtmlMode,g&&(h.domContent=o.domContent,void 0!==e?h.domHtmlMode=e:delete h.domHtmlMode);break;case'element':h.domElement!==o.domElement&&(m||a.push({treeNode:f,swap:!0}),h.domElement=o.domElement||null),h.domCloneMode=null!=o.domCloneMode?o.domCloneMode:null;break;case'portal':h.domPortal!==o.domPortal&&(m||a.push({treeNode:f,swap:!0}),h.domPortal=o.domPortal||null);break;case'contexts':{const e=h.contexts,t=o.contexts||null;if(e!==t){if(e)for(const n in e){const o=e[n];o&&o!==(t&&t[n]||null)&&(o.onRemoveFrom&&o.onRemoveFrom(f),o.roots.delete(f))}for(const n in t){const o=t[n];o&&o!==(e&&e[n]||null)&&(o.onInsertInto&&o.onInsertInto(f,n),o.roots.set(f,n))}h.contexts=t}break}}switch(o._uiDefType){case'dom':case'content':case'element':if(m)a.push({treeNode:f,create:!0});else{const e='moved'===h.action&&-1===i.indexOf(f),t=!!h.tag&&(!d||'contextual'===d&&(g||e)||!n.equalDomProps(y||{},o.props||{}));if(t||g||e){const n={treeNode:f};t&&(n.update=!0),g&&(n.content=!0),e&&(n.move=!0,i.push(f)),a.push(n)}}break;case'boundary':if(m){const e=new P(t.uiHost,h,f,r);e.parentBoundary=t,e.outerContexts=Object.assign({},p),f.boundary=e}break;case'portal':m&&a.push({treeNode:h.treeNode,create:!0});break;case'host':h.host&&null===h.host.groundedTree.parent&&(h.host.groundedTree.parent=f,f.children=[h.host.groundedTree],a.push({treeNode:f,move:!0}),h.host.settings.welcomeContextsUpRoot&&h.host.services.onContextPass(p))}if((h.attachedRefs||o.attachedRefs)&&w.handleAttachedRefs(h,o),(h.attachedContexts||o.attachedContexts)&&w.handleAttachedContexts(h,o),f.boundary){const n=f.boundary;t.innerBoundaries.push(n);let r=null;if(o.childDefs[0]){const e=n.contentClosure.envelope;r=e?{appliedDef:Object.assign(Object.assign({},e.appliedDef),{childDefs:h.childDefs,action:h.action}),targetDef:Object.assign(Object.assign({},e.targetDef),{childDefs:o.childDefs})}:{appliedDef:{tag:null,_uiDefType:'fragment',childDefs:h.childDefs,action:'mounted'},targetDef:{tag:null,_uiDefType:'fragment',childDefs:o.childDefs}}}let d=n.contentClosure.preRefresh(r);const l=d.length;if(!m){let t=0;const o=n.contextApi;for(const s in n.outerContexts){const r=n.outerContexts[s];p[s]===r||o&&void 0!==o.getContext(s)||(t|=e.Otherwise,o&&(t|=w.helpUpdateContext(n,s,p[s]||null,r)))}for(const s in p){if(void 0!==n.outerContexts[s])continue;const r=p[s];n.outerContexts[s]===r||o&&void 0!==o.getContext(s)||(t|=e.Otherwise,o&&(t|=w.helpUpdateContext(n,s,r,null)))}t&&(n._outerContextsWere=n.outerContexts,n.outerContexts=Object.assign({},p),o&&w.shouldUpdateContextually(t)&&(n._preUpdates||(n._preUpdates={}),n._preUpdates.contextual=!0))}const y=t.uiHost.services.updateSourceBoundary(n,s,i,d);if(y&&(a=a.concat(y[0]),c=c.concat(y[1])),n._outerContextsWere){const e=w.afterOuterContexts(n);if(e[0])if(d[0])for(const t of e)-1===d.indexOf(t)&&d.push(t);else d=e}if(h.attachedRefs)for(const e of h.attachedRefs)u.didAttachOn(e,f);if(d[0]){const e=w.updateInterested(d,d[1]&&l!==d.length||!1);a=a.concat(e[0]),c=c.concat(e[1])}const g=n.contentClosure.applyRefresh(s);a=a.concat(g[0]),c=c.concat(g[1])}}return[a,c]},pairDefs(e,t,n,o,s,r,i){const d=e.uiHost.settings,a=[],c=e.uiId?e:e.sourceBoundary;let l,u=[[{childDefs:[t]},{childDefs:[n]},e.baseTreeNode,Object.assign({},e.outerContexts),!1]],h=0;for(;l=u[h];){h++;const[e,t,n,f,p]=l;if(e.childDefs[0]){const a=w.findAppliedChildDefs(t,e,o,s,c,d);t.childDefs=a;const l=n&&'boundary'!==e._uiDefType&&('element'!==e._uiDefType||e.domElement)?w.assignTreeNodesForChildren(a,n,p,c,i):[],m=[];for(let t,n=0;t=e.childDefs[n];n++){const e=l[n],o=a[n];!e&&o.treeNode&&(o.treeNode.sourceBoundary=null,r&&r.push(o));const s=t.contexts?w.mergeOuterContexts(f,t.contexts):f;m.push([t,o,l[n]||null,s,'fragment'===t._uiDefType])}u=m.concat(u.slice(h)),h=0}else t.childDefs=[];n&&e._uiDefType&&t._uiDefType&&a.push([e,t,n,f])}return a},findAppliedChildDefs(e,t,n,o,r,i){let d=t.childDefs.length;if(!d)return[];const a=!!i&&i.wideKeysInArrays,c=a||!t.isArray;if(!a&&t.isArray!=(e&&e.isArray))return t.childDefs.map((e=>s.newAppliedDefBy(e,r&&r.contentClosure||null)));const l=!i||i.reuseSiblingTags,u=!!i&&i.noRenderValuesMode,h=e&&e.childDefs.slice()||null,f=[];for(let i=0;i<d;i++){const a=t.childDefs[i];let p=!1;if(u&&'content'===a._uiDefType?p=!0===u?!a.domContent:-1!==u.indexOf(a.domContent):'fragment'===a._uiDefType&&a.props&&a.props.needsChildren&&(p=!r||!r.contentClosure.envelope),p){t.childDefs.splice(i,1),d--,i--;continue}const m=null!=a.key,y=w.SEARCH_TAG_BY_TYPE[a._uiDefType]||a.tag;let g=null;if(h&&(m||l)){let e=-1;for(const t of h){e++;if((w.SEARCH_TAG_BY_TYPE[t._uiDefType]||t.tag)===y&&(m?t.key===a.key:null==t.key)&&o.has(t)&&(m||!0===l||!t.tag||'string'==typeof t.tag||!('dom'===l||'dom-mini'===l&&(t.tag.UI_DOM_TYPE?'Mini'!==t.tag.UI_DOM_TYPE:t.tag.length>=2)))){g=t,h.splice(e,1),o.delete(t);break}}}if(!g&&m&&c){const e=n&&n.get(y);if(e){let t=-1;for(const n of e)if(t++,n.key===a.key&&n.keyScope===a.keyScope&&o.has(n)){g=n,o.delete(n),e.splice(t,1);break}}}g?g.action=e&&e.childDefs[i]===g?'updated':'moved':g=s.newAppliedDefBy(a,r&&r.contentClosure||null),f.push(g)}return f},assignTreeNodesForChildren(e,t,n,o,s){t.children[0]&&(t.children=[]);const r=e.length;if(!r)return[];const i=[];let d=0,a=null,c=t;if(n){if(!t.parent)return[];if(c=t.parent,a=t,d=c.children.indexOf(t),-1===d)return[]}for(let t=0;t<r;t++){const n=e[t];let r=null;n.treeNode?r=n.treeNode:'fragment'!==n._uiDefType&&(n.action='mounted'),a&&(r?c.children.splice(d,1):r=a,a=null);const l=n._uiDefType,u='content'===l||'element'===l?'dom':'fragment'===l?'':l;if(r){if(r.parent){const e=r.parent.children.indexOf(r);0===e&&r.parent!==c&&!0===v.PASSING_TYPES[r.parent.type]&&s&&-1===s.indexOf(r.parent)&&s.push(r.parent),-1!==e&&r.parent.children.splice(e,1)}r.parent=c,r.sourceBoundary=o||null,r.type=u}else r={type:u,parent:c,children:[],sourceBoundary:o||null,domNode:null},'dom'===r.type&&(r.domProps={});'fragment'!==n._uiDefType&&(r.def=n,n.treeNode=r),c.children.splice(d+t,0,r),i.push(r)}return i},assignTreeNodesForPass(e){const t=e._innerDef,n=e.sourceBoundary,o=[],s=[],r=[];let i,d=[[e.targetDef,t,e.baseTreeNode,Object.assign({},e.outerContexts),!1]],a=0;for(;i=d[a];){a++;const[e,t,c,l,u]=i;if(e.childDefs[0]){const r=c&&'boundary'!==e._uiDefType&&('element'!==e._uiDefType||e.domElement)?w.assignTreeNodesForChildren(t.childDefs,c,u,n,s):[];let i=0;const h=[];for(const n of t.childDefs){const t=r[i];!t&&n.treeNode&&(o.push(n.treeNode),n.treeNode.sourceBoundary=null);const s=e.childDefs[i],d=s.contexts?w.mergeOuterContexts(l,s.contexts):l;h.push([s,n,t,d,'fragment'===n._uiDefType]),i++}d=h.concat(d.slice(a)),a=0}c&&r.push([e,t,c,l])}return[r,o,s]},buildDefMaps(e){const t=new Set,n=new Map;let o,s=[e],r=0;for(;o=s[r];){r++,t.add(o);const e=w.SEARCH_TAG_BY_TYPE[o._uiDefType]||o.tag,i=n.get(e);i?i.push(o):n.set(e,[o]),o.childDefs[0]&&(s=o.childDefs.concat(s.slice(r)),r=0)}return[n,t]},cleanUpBoundaryDefs(e,t=!1){t&&console.log('___Apply.cleanUpBoundaryDefs: Dev-log: Clean up unused defs: ',[...e]);let n=[];for(const t of e){const e=t.treeNode;if(e){switch(t._uiDefType){case'dom':case'element':case'content':n.push({treeNode:e,remove:!0});break;case'boundary':e.boundary&&(n=n.concat(w.destroyBoundary(e.boundary,!1)[0]));break;case'pass':t.contentPass&&(n=n.concat(t.contentPass.contentUngrounded(t)[0]));case'host':t.host&&t.host.groundedTree.parent===e&&(t.host.groundedTree.parent=null,e.children=[],n.push({treeNode:e,move:!0}));case'contexts':if(t.contexts)for(const n in t.contexts){const o=t.contexts[n];o.onRemoveFrom&&o.onRemoveFrom(e),o.roots.delete(e)}default:if(t.attachedRefs&&t._uiDefType)for(const n of t.attachedRefs)u.willDetachFrom(n,e)}e.parent=null,e.sourceBoundary=null,delete t.treeNode}}return n},destroyBoundary(e,t=!0,n=!0){let o=[];const s=w.findBoundariesWithin(e,!0);for(const e of s){if(null===e.isMounted)continue;const s=e.uiId?e:null;if(s){const e=s.live;if(e){e.uiWillUnmount&&e.uiWillUnmount(),e.clearTimers();const t=s,n=t.contextApi.getContexts();for(const e in n){const o=n[e];o&&w.helpUpdateContext(t,e,null,o)}}}if(e.mini&&e.mini instanceof D){const t=e.mini.constructor;t.wiredWillUnmount&&t.wiredWillUnmount(e.mini,e),t.instanced.delete(e)}const r=n?e.getTreeNodesForDomRoots(!1):[];if(e._innerDef&&e._innerDef.childDefs[0]){let o,i=[e._innerDef],d=0;for(;o=i[d];){d++,o.childDefs[0]&&(i=o.childDefs.concat(i.slice(d)),d=0);const e=o.treeNode;if(e){const i='dom'===e.type;if(o.attachedRefs)for(const t of o.attachedRefs)i?n&&-1===r.indexOf(e)&&r.push(e):t.uiWillUnmount&&e.boundary&&'boundary'===e.type&&t.uiWillUnmount(e.boundary),u.willDetachFrom(t,e);i&&!s&&t&&(e.sourceBoundary=null,e.parent=null,delete o.treeNode)}}}if(e._outerDef.attachedRefs)for(const t of e._outerDef.attachedRefs)s&&t.uiWillUnmount&&t.uiWillUnmount(s),u.willDetachFrom(t,e.baseTreeNode);s&&s.uiHost.services.removeFromUpdates(s),n&&(o=o.concat(r.map((e=>({treeNode:e,remove:!0}))))),e.isMounted=null}return[o,[]]},handleAttachedRefs(e,t){const n=e.treeNode;if(e.attachedRefs&&n)for(const o of e.attachedRefs)t.attachedRefs&&-1!==t.attachedRefs.indexOf(o)||u.willDetachFrom(o,n);e.attachedRefs=t.attachedRefs},handleAttachedContexts(t,n){if(!t.treeNode||!t.attachedContexts&&!n.attachedContexts)return;const o=t.treeNode,s='boundary'===o.type&&o.boundary||null,r=t.attachedContexts||{};t.attachedContexts=n.attachedContexts;const i=s&&s.contextApi;if(i&&(i.actionNeeds||i.contextNeeds.size)){const t=i.overriddenContexts||{},o=n.attachedContexts||{},d=new Set([...Object.keys(r),...Object.keys(o)]);let a=0;for(const n of d){if(void 0!==t[n])continue;const i=void 0===r[n]?s.outerContexts[n]:r[n],d=o[n];d!==i&&(a|=e.Otherwise,a|=w.helpUpdateContext(s,n,d,i))}w.shouldUpdateContextually(a)&&(s._preUpdates||(s._preUpdates={}),s._preUpdates.contextual=!0)}},helpUpdateContext(t,n,o,s){let r=0;if(t.contextApi.contextNeeds.has(n)&&(s&&s.services.onDisInterest('data',t,n),o&&o.services.onInterest('data',t,n),r|=e.Data),t.contextApi.actionNeeds.has(n)&&(s&&s.services.onDisInterest('actions',t,n),o&&o.services.onInterest('actions',t,n),r|=e.Actions),t.live.onContextChange){const i=t.live.onContextChange(n,o,s);null!==i&&(r|=i?e.DoRefresh:e.NoRefresh)}return r},mergeOuterContexts(e,t){const n=Object.assign({},e);for(const e in t){const o=t[e];o?n[e]=o:delete n[e]}return n},afterOuterContexts(t){const n=[];if(!t._outerContextsWere)return n;const o={},s=t.outerContexts;for(const e in t.outerContexts){const n=t._outerContextsWere[e];t.outerContexts[e]!==n&&(o[e]=n)}for(const e in t._outerContextsWere)void 0===t.outerContexts[e]&&(o[e]=t._outerContextsWere[e]);t.outerContexts=t._outerContextsWere,delete t._outerContextsWere;let r,i=[[t.baseTreeNode,o]],d=0;for(;r=i[d];){d++;const t=r[0],o=r[1];if('host'===t.type){const e=t.def.host;if(e&&e.settings.welcomeContextsUpRoot){const t=e.rootBoundary,n=Object.assign({},t.outerContexts);let r=!1;for(const e in o)if(t.outerContexts[e]===o[e]){r=!0;const t=s[e];t?n[e]=t:delete n[e]}r&&e.services.onContextPass(n)}}else if(t.boundary){const r=t.boundary,a={};let c=0;for(const t in o)if(r.outerContexts[t]===o[t]){const o=s[t],i=a[t];if(o?r.outerContexts[t]=o:delete r.outerContexts[t],a[t]=i,c|=e.Otherwise,r.contextApi){if(o!==r.contextApi.getContext(t))continue;c|=w.helpUpdateContext(r,t,o,i),void 0!==r.contextApi.contextNeeds.get(t)&&-1===n.indexOf(r)&&n.push(r)}}if(delete r._outerContextsWere,!c)continue;r.uiId&&w.shouldUpdateContextually(c)&&(r._preUpdates||(r._preUpdates={}),r._preUpdates.contextual=!0),t.children[0]&&(i=t.children.map((e=>[e,a])).concat(i.slice(d)),d=0)}else if(t.children[0]){const e='contexts'===t.type?t.def.contexts:null;let n=o;if(e){const t=[];for(const n in o)void 0!==e[n]&&t.push(n);if(t[0]){n=Object.assign({},o);for(const e of t)delete n[e];void 0===Object.keys(n)[0]&&(n=null)}}n&&(i=t.children.map((e=>[e,n])).concat(i.slice(d)),d=0)}}return n},shouldUpdateContextually:t=>0==(t&e.NoRefresh)&&0!=(t&(e.DoRefresh|e.Data)),shouldUpdateBy(e,t,o){const s=e.uiHost.settings,r=e.live?e.live.updateModes:{props:e.mini&&(e.mini.updateMode||e.mini.constructor.updateMode)||s.updateMiniMode};let i=!1;if(t)for(const e in t){i=!0;switch(r[e]||s.updateLiveModes[e]){case'always':return!0;case'changed':if(t[e]!==o[e])return!0;break;case'shallow':if(!n.areEqual(t[e]||{},o[e],1))return!0;break;case'double':if(!n.areEqual(t[e]||{},o[e],2))return!0;break;case'deep':if(!n.areEqual(t[e]||{},o[e],-1))return!0}}return!i&&(e.mini?'always'===s.updateMiniMode:s.shouldUpdateWithNothing)},callBoundaryChanges(e){for(const t of e){const[e,n,o,s]=t;switch(n){case'updated':e.live&&e.live.uiDidUpdate&&e.live.uiDidUpdate(o||{},s||{});break;case'mounted':{const t=e.live;if(t&&t.uiDidMount&&t.uiDidMount(),e._outerDef.attachedRefs)for(const t of e._outerDef.attachedRefs)t.uiDidMount&&t.uiDidMount(e);break}case'moved':e.live&&e.live.uiDidMove&&e.live.uiDidMove();break;case'updated-n-moved':e.live&&e.live.uiDidMove&&e.live.uiDidMove(),e.live&&e.live.uiDidUpdate&&e.live.uiDidUpdate(o||{},s||{})}}},preSetUpdates(e,t){const n=e.live;let o=e._preUpdates;o||(e._preUpdates=o={}),t.props&&(o.props||(o.props=e._outerDef.props||{}),e._outerDef.props=t.props,n?n.props=t.props:e.mini&&(e.mini.props=t.props)),t.state&&n&&(o.state||(o.state=n.state),n.state=t.state),t.children&&e.contentClosure&&(o.children||(o.children=e.contentClosure.envelope?e.contentClosure.envelope.targetDef.childDefs.slice():[])),t.contextual&&n&&(o.contextual||(o.contextual=!0)),t.force&&(o.force='all'!==t.force&&'all'!==o.force||'all')},sortBoundaries(e){const t=new Map;for(const n of e){let e=n.uiId,o=n.parentBoundary;for(;o;)e=(o.uiId||'')+'>'+e,o=o.parentBoundary;const s=t.get(e);if(s){let e=0;if(n.parentBoundary){const t=n.parentBoundary.innerBoundaries,o=t.indexOf(n);for(const n of s){if(o<t.indexOf(n))break;e++}}s.splice(e,0,n)}else t.set(e,[n])}const n=[];for(const e of t.keys()){let t=0,o=!1;for(const s of n){if(s.startsWith(e+'>'))break;if(e.startsWith(s+'>'))o=!0;else if(o)break;t++}n.splice(t,0,e)}let o=0;for(const s of n)for(const n of t.get(s))e[o]=n,o++},updateInterested(e,t=!0){let n=[],o=[];t&&w.sortBoundaries(e);for(const t of e){if(!t._preUpdates)continue;const e=t.uiHost.services.updateSourceBoundary(t);e&&(n=n.concat(e[0]),o=o.concat(e[1]))}return[n,o]},refreshWithTimeout(e,t,n,o,s){null!==n&&void 0!==s&&(window.clearTimeout(n),n=null);const r=void 0===s?o:s;return null===r?t.call(e):null===n&&(n=window.setTimeout((()=>t.call(e)),r)),n},findBoundariesWithin(e,t=!0){const n=[];let o,s=[e],r=0;for(;o=s[r];)r++,null!==o.isMounted&&(n.push(o),(t||e===o)&&o.innerBoundaries[0]&&(s=o.innerBoundaries.concat(s.slice(r)),r=0));return n},findTreeNodesWithin(e,t,n=0,o=!1,s=!1,r){const i=[];let d,a=[e],c=0;const l=e.boundary;for(;d=a[c];)if(c++,!d.boundary||null!==d.boundary.isMounted){if(t[d.type]&&(!r||r(d))){const e=i.push(d);if(n&&e>=n)return i}d.boundary&&!o&&d.boundary!==l||('host'!==d.type||s)&&d.children[0]&&(a=d.children.concat(a.slice(c)),c=0)}return i},getTreeNodesForDomRootsUnder(e,t=!1,n=!1,o=0){let s=[];for(const r of e.children)if(r.domNode||n)switch(r.type){case'dom':if(s.push(r),o&&s.length>=o)return s;break;case'boundary':case'pass':case'host':if(!t)break;case'contexts':case'root':if(s=s.concat(w.getTreeNodesForDomRootsUnder(r,t,n,o-s.length)),o&&s.length>=o)return s.slice(0,o)}return s}};function M(e){var o;return(o=class extends e{constructor(e,...t){super(...t),this.props=e,this.updateModes={},this.wired=null}update(e,t,n){this.boundary.uiHost.services.addToUpdates(this.boundary,{force:e||!1},t,n)}setState(e,t,n,o){const s=Object.assign(Object.assign({},this.state),e);this.boundary.updateBy({state:s},t,n,o)}setInState(e,t,n,o,s){const r=Object.assign(Object.assign({},this.state||{}),{[e]:t});this.boundary.updateBy({state:r},n,o,s)}addTimer(e,t,n,o=!0){this._timers?this._timers.has(e)&&this.clearTimer(e):this._timers=new Map,this._timers.set(e,window.setTimeout((()=>{this.clearTimer(e),o?t.call(this):t()}),n))}hasTimer(e){return!!this._timers&&this._timers.has(e)}clearTimer(e){if(!this._timers)return;const t=this._timers.get(e);null!=t&&(window.clearTimeout(t),this._timers.delete(e))}clearTimers(e){if(this._timers)if(e)for(const t of e)this.clearTimer(t);else this._timers.forEach((e=>window.clearTimeout(e))),this._timers.clear()}isMounted(){return!0===this.boundary.isMounted}queryDomElement(e,t=!1,n=!1){return O.queryDomElement(this.boundary.baseTreeNode,e,t,n)}queryDomElements(e,t=0,n=!1,o=!1){return O.queryDomElements(this.boundary.baseTreeNode,e,t,n,o)}findDomNodes(e=0,t=!1,n=!1,o){return w.findTreeNodesWithin(this.boundary.baseTreeNode,{dom:!0},e,t,n,o).map((e=>e.domNode))}findBoundaries(e=0,t=!1,n=!1,o){return w.findTreeNodesWithin(this.boundary.baseTreeNode,{boundary:!0},e,t,n,o).map((e=>e.boundary))}findTreeNodes(e,t=0,o=!1,s=!1,r){return w.findTreeNodesWithin(this.boundary.baseTreeNode,n.buildRecordable(e),t,o,s,r)}getChildren(e=!1,t=!0){return this.boundary.contentApi&&this.boundary.contentApi.getChildren(e,t)||[]}needsChildren(e){this.boundary.contentApi&&this.boundary.contentApi.needsChildren(e)}initContext(e,...t){this.context=e,t.length&&this.needsContexts(...t)}needsContext(e,t=!0,n=!0){this.boundary.contextApi.needsContext(e,t,n)}needsContexts(...e){const t={};for(const n of e)if('string'==typeof n)t[n]=!0;else for(const e in n)t[e]=n[e];this.boundary.contextApi.needsContexts(t)}needsAction(e,t,n){this.boundary.contextApi.needsAction(e,t,n)}needsActions(e,t=[],n){this.boundary.contextApi.needsActions(e,t,n)}setContextData(e,t,n=!1,o=!0,s){const r=this.boundary.contextApi.getContext(e);r&&r.setData(t,n,o,s)}setInContextData(e,t,n,o=!1,s=!0,r){const i=this.boundary.contextApi.getContext(e);i&&i.setInData(t,n,o,s,r)}getContextData(e,t){const n=this.boundary.contextApi.getContext(e);return n?n.data:t}getInContextData(e,t,n){const o=this.boundary.contextApi.getContext(e);return o?o.getInData(t):n}refreshInContext(e,t=!0,n){const o=this.boundary.contextApi.getContext(e);o&&o.refreshBy(t,n)}dispatchAction(e,t,n,o){const s=this.boundary.contextApi.getContext(e);s&&s.dispatchAction(t,n,o)}dispatchActionWith(e,t,n,o,s){const r=this.boundary.contextApi.getContext(e);r&&r.dispatchAction({type:t,payload:n},o,s)}dispatchQuestion(e,t,n){const o=this.boundary.contextApi.getContext(e);return o?o.dispatchQuestion(t,n):void 0===n?t.value:n}dispatchQuestionWith(e,t,n,o,s=0){const r=this.boundary.contextApi.getContext(e);return r?r.dispatchQuestion({type:t,payload:n,value:o},s):[]}dispatchQuestionary(e,t,n=0){const o=this.boundary.contextApi.getContext(e);return o?o.dispatchQuestionary(t,n):t.values||[]}dispatchQuestionaryWith(e,t,n,o=0){const s=this.boundary.contextApi.getContext(e);return s?s.dispatchQuestionary({type:t,payload:n,values:[]},o):[]}hasContext(e){return!!this.boundary.contextApi.getContext(e)}getContext(e,n=t.All){return this.boundary.contextApi.getContext(e,n)}getContexts(e,t){return this.boundary.contextApi.getContexts(e,t)}overrideContext(e,t,n=!0){this.boundary.contextApi.overrideContext(e,t,n)}overrideContexts(e,t=!0){this.boundary.contextApi.overrideContexts(e,t)}createContext(e,t,n=!0){const o=q.createContext(e);return t&&this.boundary.contextApi.overrideContext(t,o,n),o}createContexts(e,t=!1,n=!0){const o=q.createContexts(e);return t&&this.boundary.contextApi.overrideContexts(o,n),o}createWired(e,t,n,...o){const s=q.createWired(e,t,n,...o);return this.wired?this.wired.add(s):this.wired=new Set([s]),s}render(){return q.Content}static queryDomElement(e,t,n=!1,o=!1){const s=w.findTreeNodesWithin(e,{dom:!0},1,n,o,(e=>e.domNode&&e.domNode instanceof Element&&e.domNode.matches(t)))[0];return s&&s.domNode||null}static queryDomElements(e,t,n=0,o=!1,s=!1){return w.findTreeNodesWithin(e,{dom:!0},n,o,s,(e=>e.domNode&&e.domNode instanceof Element&&e.domNode.matches(t))).map((e=>e.domNode))}static findTreeNodes(e,t,o=0,s=!1,r=!1,i){return w.findTreeNodesWithin(e,n.buildRecordable(t),o,s,r,i)}}).UI_DOM_TYPE='Live',o}class O extends(M(Object)){constructor(e,...t){super(e,...t)}}const U=e=>(t,n)=>e(n,t);class B{constructor(e){this.uiHost=e,this.uiRender=new v(e.settings),this.idCounter=0,this.updateTimer=null,this.pendingTimer=null,this.pendingRenderInfos=[],this.pendingBoundaryCalls=[],this.delayedUpdates=new Set,this.listeners={update:[],render:[]}}createBoundaryId(){const e=this.idCounter;return this.idCounter++,'q-'+e.toString()}clearTimers(e=!1){e||this.applyUpdates(null),null!==this.updateTimer&&(window.clearTimeout(this.updateTimer),this.updateTimer=null),null!==this.pendingTimer&&(window.clearTimeout(this.pendingTimer),this.pendingTimer=null)}addListener(e,t){const n=this.listeners[e],o=n.indexOf(t);-1!==o?n[o]=t:n.push(t)}removeListener(e,t){const n=this.listeners[e],o=n.indexOf(t);-1!==o&&n.splice(o,1)}onContextPass(e){const t=this.uiHost.rootBoundary;t._outerContextsWere||(t._outerContextsWere=t.outerContexts),t.outerContexts=Object.assign({},e);const n=w.afterOuterContexts(t);for(const e of n)e._preUpdates&&this.addToUpdates(e,{contextual:!0});this.applyUpdates()}removeFromUpdates(e){this.delayedUpdates.delete(e)}hasPending(e=!0,t=!0){return e&&null!==this.updateTimer||t&&null!==this.updateTimer||!1}addToUpdates(e,t,n,o){null!==e.isMounted&&(void 0!==o&&(null===o||void 0===this._forceRenderTimeout||null!==this._forceRenderTimeout&&o<this._forceRenderTimeout)&&(this._forceRenderTimeout=o),w.preSetUpdates(e,t),e._renderingState?e._renderingState='re-updated':this.delayedUpdates.has(e)||(this.delayedUpdates.add(e),this._isUpdating||this.refreshWithTimeout('update',n)))}applyUpdates(e){for(this.updateTimer=null,this._isUpdating=!0,e=void 0!==e?e:void 0!==this._forceRenderTimeout?this._forceRenderTimeout:this.uiHost.settings.renderTimeout,delete this._forceRenderTimeout;this.delayedUpdates.size;){let e=[...this.delayedUpdates];this.delayedUpdates.clear(),e[1]&&w.sortBoundaries(e);let t=[],n=[];for(const o of e){const e=this.updateSourceBoundary(o);e&&(t=t.concat(e[0]),n=n.concat(e[1]))}t[0]&&this.pendingRenderInfos.push(t),n[0]&&(this.uiHost.settings.uiDidImmediateCalls?w.callBoundaryChanges(n):this.pendingBoundaryCalls.push(n))}if(this.listeners.update[0])for(const e of this.listeners.update)e();this.refreshWithTimeout('render',e),delete this._isUpdating}updateSourceBoundary(e,t=!1,n,o){let s=!!t,r='all'===t,i=[],d=[];const a=e.contextApi,c=!o;if(o||(o=[]),e.isMounted){let c=e._preUpdates;if(!c){if(!t)return null;c={}}const l={},u={};c.props&&(l.props=c.props,u.props=e._outerDef.props);const h=e.live;if(h&&a&&(c.state&&(l.state=c.state,u.state=h.state),c.contextual&&(l.context=h.context,a.rebuildContext(),u.context=h.context)),c.force)s=!0,'all'===c.force&&(r=!0);else if(!s){let t=null;if(h)h.uiShouldUpdate&&(t=h.uiShouldUpdate(l,u));else if(e.mini)if(l.children&&l.children!==u.children)t=!0;else{const n=e.mini.shouldUpdate?e.mini:'mini'===e.type&&e.mini.constructor||null;n&&n.shouldUpdate&&(t=n.shouldUpdate(l.props||null,u.props||null))}(!0===t||null===t&&w.shouldUpdateBy(e,l,u))&&(s=!0)}const f='moved'===e._outerDef.action,p=f?s?'updated-n-moved':'moved':s?'updated':'';if(p&&d.push([e,p,l,u]),f){if(a){const t=a.getContexts();for(const n in t){const o=t[n];o&&o.services.onBoundaryMove(e,n)}}for(const t of w.getTreeNodesForDomRootsUnder(e.baseTreeNode,!0,!0)){if(n){if(-1!==n.indexOf(t))continue;n.push(t)}i.push({treeNode:t,move:!0})}}delete e._preUpdates;const m=e.live&&e.live.wired||null;if(m)for(const e of m){const t=e.props;if(e.refresh(!1),t!==e.props)for(const t of e.instanced)t._preUpdates||(t._preUpdates={}),t._preUpdates.force||(t._preUpdates.force=!0),-1===o.indexOf(t)&&o.push(t)}h&&h.uiBeforeUpdate&&h.uiBeforeUpdate(l,u,s)}else{if(null===e.isMounted)return null;d.push([e,'mounted']),s=!0}if(s){const[t,n]=w.runBoundaryUpdate(e,r);i=i.concat(t),d=d.concat(n)}if(c&&o[0]){const e=w.updateInterested(o,!0);i=i.concat(e[0]),d=d.concat(e[1])}return i[0]||d[0]?[i,d]:null}addToPostPending(e,t,n){e&&this.pendingRenderInfos.push(e),t&&(this.uiHost.settings.uiDidImmediateCalls?w.callBoundaryChanges(t):this.pendingBoundaryCalls.push(t)),this.refreshWithTimeout('render',n)}applyPostPending(){this.pendingTimer=null;for(const e of this.pendingRenderInfos)e[0]&&this.uiRender.applyToDom(e);this.pendingRenderInfos=[];for(const e of this.pendingBoundaryCalls)e[0]&&w.callBoundaryChanges(e);if(this.pendingBoundaryCalls=[],this.listeners.render[0])for(const e of this.listeners.render)e()}refreshWithTimeout(e,t){'update'===e?this.updateTimer=w.refreshWithTimeout(this,this.applyUpdates,this.updateTimer,this.uiHost.settings.updateTimeout,t):this.pendingTimer=w.refreshWithTimeout(this,this.applyPostPending,this.pendingTimer,this.uiHost.settings.renderTimeout,t)}}function R(e){var t;return(t=class extends e{constructor(e,t,n){super(),this.settings=S.getDefaultSettings(n),this.services=new B(this),this.groundedTree={type:'root',parent:null,children:[],domNode:t||null,sourceBoundary:null},this.targetDef=s.createDefFromContent(e);const o=s.newAppliedDefBy({_uiDefType:'boundary',tag:()=>this.isDisabled?null:this.targetDef,props:{},childDefs:[]},null),r={type:'boundary',def:o,sourceBoundary:null,boundary:null,parent:this.groundedTree,children:[],domNode:null};this.groundedTree.children.push(r),this.rootBoundary=new P(this,o,r),this.rootBoundary.mini&&(this.rootBoundary.mini.updateMode='always'),r.boundary=this.rootBoundary,this.services.addToUpdates(this.rootBoundary,{})}addListener(e,t){this.services.addListener(e,t)}removeListener(e,t){this.services.removeListener(e,t)}renderWith(e,t,n){this.targetDef=s.createDefFromContent(e),this.rootBoundary.update(!0,t,n)}clearContents(e=!0,t,n){this.services.clearTimers(!0),this.targetDef=null,e&&this.rootBoundary.update(!0,t,n)}modifySettings(e){const t=this.settings.onlyRunInContainer,n=this.settings.welcomeContextsUpRoot;if(S.modifySettings(this.settings,e),void 0!==n&&n!==e.welcomeContextsUpRoot){const e=this.groundedTree.parent&&this.groundedTree.parent.sourceBoundary&&this.groundedTree.parent.sourceBoundary.uiHost,t=e&&this.settings.welcomeContextsUpRoot?e.rootBoundary.outerContexts:{};this.services.onContextPass(t)}void 0!==e.onlyRunInContainer&&e.onlyRunInContainer!==t&&this.refresh(!1,null,null)}refresh(e=!1,t,n){const o=!this.isDisabled,s=!(this.settings.onlyRunInContainer&&!this.groundedTree.domNode&&!this.groundedTree.parent);if(s?delete this.isDisabled:this.isDisabled=!0,!e&&s&&o){if(s&&o){const e=this.rootBoundary?this.rootBoundary.getTreeNodesForDomRoots(!0).map((e=>({treeNode:e,move:!0}))):[];this.services.addToPostPending(e,null,n)}}else this.rootBoundary.update(!0,t,n)}refreshRender(e=!1,t){const n=!e||'read',o=[];let s,r=[...this.groundedTree.children],i=0;for(;s=r[i];)i+=1,s.domProps&&o.push({treeNode:s,refresh:n}),s.children[0]&&(r=s.children.concat(r.slice(i)),i=0);this.services.addToPostPending(o,null,t)}moveInto(e,t){if(this.groundedTree.domNode===e)return;this.groundedTree.domNode=e;const n=this.rootBoundary.getTreeNodesForDomRoots(!0).map((e=>({treeNode:e,move:!0})));(n[0]||void 0!==t)&&this.services.addToPostPending(n,null,t)}getRootDomNode(){return this.rootBoundary&&this.rootBoundary.baseTreeNode.domNode}getRootDomNodes(e=!0){return this.rootBoundary?w.getTreeNodesForDomRootsUnder(this.rootBoundary.baseTreeNode,e,!1).map((e=>e.domNode)):[]}queryDomElement(e,t=!1){return O.queryDomElement(this.groundedTree,e,!0,t)}queryDomElements(e,t=0,n=!1){return O.queryDomElements(this.groundedTree,e,t,!0,n)}findDomNodes(e=0,t=!1,n){return w.findTreeNodesWithin(this.groundedTree,{dom:!0},e,!0,t,n).map((e=>e.domNode))}findBoundaries(e=0,t=!1,n){return w.findTreeNodesWithin(this.groundedTree,{boundary:!0},e,!0,t,n).map((e=>e.boundary))}findTreeNodes(e,t=0,o=!1,s){return w.findTreeNodesWithin(this.groundedTree,n.buildRecordable(e),t,!0,o,s)}static modifySettings(e,t){let n=!1;if(t.updateLiveModes)for(const o in t.updateLiveModes){const s=t.updateLiveModes[o];'string'==typeof s&&(e.updateLiveModes[o]=s,n=!0)}for(const o in t){const s=t[o],r=typeof s;null!==s&&'boolean'!==r&&'string'!==r&&'number'!==r||(e[o]=s,n=!0)}return n}static getDefaultSettings(e){const t={updateTimeout:0,renderTimeout:0,uiDidImmediateCalls:!1,callRefMoveEvenIfNoDomMove:!1,shouldUpdateWithNothing:!1,updateMiniMode:'shallow',updateLiveModes:{props:'shallow',state:'shallow',context:'shallow',children:'changed'},preEqualCheckDomProps:!0,onlyRunInContainer:!1,welcomeContextsUpRoot:!0,wideKeysInArrays:!1,reuseSiblingTags:!0,noRenderValuesMode:!1,maxReRenders:1,renderTextTag:'',renderInnerHtmlTag:'span',renderTextContent:null,renderSvgNamespaceUri:'http://www.w3.org/2000/svg',renderDomPropsOnSwap:!0,duplicateDomNodeBehaviour:'deep',duplicateDomNodeHandler:null,devLogWarnings:!1,devLogRenderInfos:!1,devLogCleanUp:!1};if(e)for(const n in e)t[n]=e[n];return t}}).UI_DOM_TYPE='Host',t}class S extends(R(Object)){}const E=(e,t,n)=>new S(e,t,n);class I{constructor(e){this.uiContext=e,this.refreshKeys=null,this.refreshTimer=null,this.refreshActions=null,this.refreshPostActions=null,this.refreshOrder=0}dispatchAction(e,t,n){if(!e.type)return;let o=this.callActionHandlers(e);const s=this.uiContext.settings;'cancel'!==o&&(t&&(o=t),'post'===o||s.postActions&&s.postActions.has(e.type)?(this.refreshPostActions||(this.refreshPostActions=[]),this.refreshPostActions.push(e)):'quick'===o||!0===s.quickActions||s.quickActions&&s.quickActions.has(e.type)?this.runAction(e):(this.refreshActions||(this.refreshActions=[]),this.refreshActions.push(e))),this.refresh(s.refreshTimeout,n)}dispatchQuestion(e,t=0){this.callActionHandlers(e,!0),this.runAction(e,null,!0,t)}refresh(e,t){this.refreshTimer=w.refreshWithTimeout(this,this.refreshNow,this.refreshTimer,e,t)}refreshNow(){let e=this.refreshActions,t=this.refreshPostActions;const n=this.refreshKeys;this.refreshTimer=null,this.refreshKeys=null,this.refreshActions=null,this.refreshPostActions=null;const o=new Set,s=t?o:null;if(e)for(const t of e)this.runAction(t,s);if(n&&this.runData(n,s),t){for(const e of[...o])if(e.services.hasPending()){const t=[e],n=this.onHostPostRefresh.bind(this,t);t.push(n),e.services.addListener('render',n)}else o.delete(e);this.refreshPostDelayed||(this.refreshPostDelayed=[]),this.refreshPostDelayed.push([o,t]),o.size||this.onHostPostRefresh()}}onHostPostRefresh(e){let t=null;e&&(t=e[0],t.services.removeListener('render',e[1]));const n=this.refreshPostDelayed;if(!n)return;let o=-1;for(const[e,s]of[...n])if(o++,t&&e.delete(t),!e.size){n.splice(o--,1);for(const e of s)this.runAction(e)}n[0]||delete this.refreshPostDelayed}addRefreshKeys(e){if(!0===e)this.refreshKeys=!0;else if(e&&!0!==this.refreshKeys)if('string'==typeof e&&(e=[e]),this.refreshKeys)for(const t of e)-1===this.refreshKeys.indexOf(t)&&this.refreshKeys.push(t);else this.refreshKeys=[...e]}runData(t,n){const o=this.uiContext;let s=o.dataBoundaries;this.refreshOrder&e.Data&&s.size>1&&(o.dataBoundaries=s=I.sortCollection(s)),this.refreshOrder&=~e.Data;for(const[e,o]of s){n&&n.add(e.uiHost);for(const n of o){let o=!0===t;if(!o){const s=e.contextApi.contextNeeds.get(n);if(!0===s)o=!0;else if(s)for(const e of t)if(s.some((t=>t===e||t.startsWith(e+'.')))){o=!0;break}}if(o){e.uiHost.services.addToUpdates(e,{contextual:!0});break}}}if(o.dataListeners.size)for(const[e,n]of o.dataListeners){let s=!1;if(!0===n||!0===t)s=!0;else{const e=[...n];for(const n of t)if(e.some((e=>e===n||e.startsWith(n+'.')))){s=!0;break}}s&&e(o.data,o)}}runAction(t,n,o,s){if(!t.type)return;const r=this.uiContext;let i=r.actionBoundaries;this.refreshOrder&e.Actions&&(i.size>1&&(r.actionBoundaries=i=I.sortCollection(i)),this.refreshOrder&=~e.Actions);const d=t;for(const[e,a]of i){const i=e.contextApi.actionNeeds,c=e.live;n&&n.add(e.uiHost);for(const e of a){const n=i.get(e);if(n&&(!0===n||n.has(t.type)))if(o){if(c.uponQuestion){if(d.value=c.uponQuestion(d,r,e),!d.values)return;const t=d.values.push(d.value);if(s&&t>=s)return}}else c.uponAction&&c.uponAction(t,r,e)}}for(const[e,n]of r.actionListeners)if(n&&(!0===n||n.has(t.type)))if(o){if(d.value=e(d,r),!d.values)return;const t=d.values.push(d.value);if(s&&t>=s)return}else e(t,r)}callActionHandlers(e,t=!1){let n='';const o=this.uiContext;for(const[s,r]of o.actionHandlers)if(!0===r||r.has(e.type||''))if(t)s(e,o);else{const t=s(e,o);!t||n&&('cancel'===n||'post'===n&&'cancel'!==t)||(n=t)}return n}onInterest(t,n,o){const s='data'===t,r=s?this.uiContext.dataBoundaries:this.uiContext.actionBoundaries,i=r.get(n);i?i.add(o):r.set(n,new Set([o])),this.refreshOrder|=s?e.Data:e.Actions;const d=s?'onDataInterests':'onActionInterests';this.uiContext[d]&&this.uiContext[d](n,o,!0)}onDisInterest(e,t,n){const o='data'===e,s=o?'onDataInterests':'onActionInterests';this.uiContext[s]&&this.uiContext[s](t,n,!1);const r=o?this.uiContext.dataBoundaries:this.uiContext.actionBoundaries,i=r.get(t);i&&(i.delete(n),i.size||r.delete(t))}onBoundaryMove(t,n){const o=t.contextApi;this.refreshOrder|=(o.actionNeeds.get(n)&&e.Actions||0)|(o.contextNeeds.get(n)&&e.Data||0)}static getHostsFromTreeNodes(e){const t=new Set;for(const n of e){const e=n.sourceBoundary;e&&t.add(e.uiHost)}return t}static sortCollection(e){const t=[...e.keys()];return w.sortBoundaries(t),new Map(t.map((t=>[t,e.get(t)])))}}function k(e){var t;return(t=class extends e{constructor(e,t,...n){super(...n),this.roots=new Map,this.dataBoundaries=new Map,this.actionBoundaries=new Map,this.dataListeners=new Map,this.actionListeners=new Map,this.actionHandlers=new Map,this.data=e,this.settings={postActions:null,quickActions:null,refreshTimeout:0},this.services=new I(this),t&&this.modifySettings(t)}modifySettings(e){void 0!==e.postActions&&W.addToSettingsActions(this.settings,'postActions',e.postActions,!1),void 0!==e.quickActions&&W.addToSettingsActions(this.settings,'quickActions',e.quickActions,!1),void 0!==e.refreshTimeout&&(this.settings.refreshTimeout=e.refreshTimeout)}addAsPostActions(e,t=!0){W.addToSettingsActions(this.settings,'postActions',e,t)}addAsQuickActions(e,t=!0){W.addToSettingsActions(this.settings,'quickActions',e,t)}static addToSettingsActions(e,t,n,o=!0){if(null===n||!0===n)e[t]=n;else{const s='string'==typeof n?[n]:n,r=e[t];if(o&&r&&!0!==r)for(const e of s)r.add(e);else e[t]=new Set(s)}}addActionHandler(e,t=!0){this.actionHandlers.set(e,'object'!=typeof t||new Set('string'==typeof t?[t]:t))}removeActionHandler(e){this.actionHandlers.delete(e)}addActionListener(e,t=!0){this.actionListeners.set(e,'string'==typeof t?new Set([t]):'object'!=typeof t||new Set(t))}removeActionListener(e){this.actionListeners.delete(e)}addDataListener(e,t=!0){this.dataListeners.set(e,'string'==typeof t?new Set([t]):'object'!=typeof t||new Set(t))}removeDataListener(e){this.dataListeners.delete(e)}dispatchAction(e,t,n){this.services.dispatchAction(e,t,n)}dispatchActionWith(e,t,n,o){this.services.dispatchAction({type:e,payload:t},n,o)}dispatchQuestion(e,t){return void 0===e.value&&(e.value=t),this.services.dispatchQuestion(e,1),e.value}dispatchQuestionWith(e,t,n){const o={type:e,payload:t,value:n};return this.services.dispatchQuestion(o,1),o.value}dispatchQuestionary(e,t=0){return e.values=[],this.services.dispatchQuestion(e,t),e.values}dispatchQuestionaryWith(e,t,n=0){const o={type:e,payload:t,values:[]};return this.services.dispatchQuestion(o,n),o.values}setData(e,t=!1,n=!0,o){this.data=t&&this.data&&this.data.constructor===Object?Object.assign(Object.assign({},this.data),e):e,n&&this.refreshBy(!0,o)}setInData(e,t,n=!1,o=!0,s){const r=e.split('.'),i=r.pop();if(!i||!this.data)return;let d=this.data;for(const e of r)d=r[e];if(n){const e=d[i];e&&e.constructor===Object?d[i]=Object.assign(Object.assign({},e),t):n=!1}n||(d[i]=t),o&&this.refreshBy(e,s)}getData(){return this.data}getInData(e){const t=e.split('.');let n=this.data;for(const e of t)n=n[e];return n}refreshBy(e=!0,t){e&&this.services.addRefreshKeys(e),this.services.refresh(this.settings.refreshTimeout,t)}refresh(e){this.services.refresh(this.settings.refreshTimeout,e)}}).UI_DOM_TYPE='Context',t}class W extends(k(Object)){constructor(e,t){super(e,t)}}const H=(e,t)=>new W(e,t);class j{constructor(e){}}j.UI_DOM_TYPE='Contexts';const L=s.newContentPassDef(),F=s.newContentPassDef({},!0),q={Host:S,HostMixin:R,Live:O,LiveMixin:M,Mini:y,MiniMixin:m,Ref:u,RefMixin:l,Effect:c,EffectMixin:a,Context:W,ContextMixin:k,ContextAttach:t,Contexts:j,Fragment:r,Portal:i,Element:d,Content:L,withContent:(...e)=>s.createDef(q.Fragment,{needsChildren:!0},...e),ContentCopy:F,copyContent:s.newContentCopyDef,create:E,createHost:E,createContext:H,createContexts:e=>{const t={};for(const n in e)t[n]=H(e[n]);return t},createRef:()=>new u,createEffect:(e,t)=>new c(e,t),createSpread:p,spread:p,createLive:U,live:U,createMini:g,mini:g,createWired:C,wired:C,createDef:s.createDef,def:s.createDef,htmlDef:(e,t,o,s)=>{const r={_uiDefType:'content',tag:t||'',childDefs:[],domContent:e,domHtmlMode:!0};return t&&o&&(r.props=n.cleanHtmlProps(o)),null!=s&&(r.key=s),r},classNames:n.cleanHtmlClass,parseStyle:n.cleanHtmlStyle,areEqual:n.areEqual,range:n.range};exports.uiDom=q;
